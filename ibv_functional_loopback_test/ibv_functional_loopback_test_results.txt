Results when not set CPU frequency and opensm running
=====================================================

$ ibv_functional_loopback_test/Release/ibv_functional_loopback_test 
Attributes of device mlx4_0:
 num_comp_vectors=8 fw_ver=2.9.1000
 node_guid=0x8c504b0003c90200 sys_image_guid=0x8f504b0003c90200
 max_mr_size=18446744073709551615 page_size_cap=4294966784 vendor_id=0x2c9 vendor_part_id=0x673c hw_ver=176
 max_qp=131000 max_qp_wr=16351 max_sge=32 max_sge_rd=30
device_cap_flags=IBV_DEVICE_BAD_PKEY_CNTR|IBV_DEVICE_BAD_QKEY_CNTR|IBV_DEVICE_AUTO_PATH_MIG|IBV_DEVICE_CHANGE_PHY_PORT|IBV_DEVICE_UD_AV_PORT_ENFORCE|IBV_DEVICE_PORT_ACTIVE_EVENT|IBV_DEVICE_SYS_IMAGE_GUID|IBV_DEVICE_RC_RNR_NAK_GEN|BIT15|IBV_DEVICE_IP_CSUM|BIT19|IBV_DEVICE_XRC|BIT21|BIT22|BIT26
 max_cq=65408 max_cqe=4194303 max_mr=524272 max_pd=32764
 max_qp_rd_atom=16 max_ee_rd_atom=0 max_res_rd_atom=2096000 max_qp_init_rd_atom=128
 max_ee_init_rd_atom=0 atomic_cap=IBV_ATOMIC_HCA
 max_ee=0 max_rdd=0 max_mw=0 max_raw_ipv6_qp=0 max_raw_ethy_qp=0
 max_mcast_grp=8192 max_mcast_qp_attach=248 max_total_mcast_qp_attach=2031616
 max_ah=0 max_fmr=0 max_map_per_fmr=8191 max_srq=65472 max_srq_wr=16383
 max_srq_sge=31 max_pkeys=128 local_ca_ack_delay=15 phys_port_cnt=2
Attributes of source port 1:
 state=IBV_PORT_ACTIVE max_mtu=IBV_MTU_4096 active_mtu=IBV_MTU_4096
 gid_tbl_len=128 port_cap_flags=0x251086a max_msg_sz=1073741824
 bad_pkey_cntr=0 qkey_viol_cntr=0 pkey_tbl_len=128 lid=1 sm_lid=1
 lmc=0 max_vl_num=3 sm_sl=0 subnet_timeout=18 init_type_reply=0
 active_width=2 active_speed=4 phys_state=5 link_layer=IBV_LINK_LAYER_INFINIBAND
Attributes of destination port 2:
 state=IBV_PORT_ACTIVE max_mtu=IBV_MTU_4096 active_mtu=IBV_MTU_4096
 gid_tbl_len=128 port_cap_flags=0x2510868 max_msg_sz=1073741824
 bad_pkey_cntr=0 qkey_viol_cntr=0 pkey_tbl_len=128 lid=2 sm_lid=1
 lmc=0 max_vl_num=3 sm_sl=0 subnet_timeout=18 init_type_reply=0
 active_width=2 active_speed=4 phys_state=5 link_layer=IBV_LINK_LAYER_INFINIBAND

Testing using sender using RDMA write and the receiver passive
message_send_qp capabilities: max_send_wr=223 max_recv_wr=1 max_send_sge=2 max_recv_sge=1 max_inline_data=28
freed_sequence_number_qp capabilities: max_send_wr=95 max_recv_wr=1 max_send_sge=2 max_recv_sge=1 max_inline_data=28
Changes to statistics for initialisation of Infiniband communications:
  Num voluntary context switches = 38 (10 -> 48)
  Num page reclaims = 1555 (125 -> 1680)
  Num page faults = 0 (0 -> 0)
  Num mlx4 interrupts = 38 (8353 -> 8391)

Changes to statistics for Infiniband single thread message transfers:
  Num voluntary context switches = 0 (48 -> 48)
  Num page reclaims = 0 (1681 -> 1681)
  Num page faults = 0 (0 -> 0)
  Num mlx4 interrupts = 0 (8391 -> 8391)

Changes to statistics for Infiniband multi-threaded message transfers:
  Num voluntary context switches = 84 (48 -> 132)
  Num page reclaims = 0 (1681 -> 1681)
  Num page faults = 0 (0 -> 0)
  Num mlx4 interrupts = 36 (8391 -> 8427)


Test duration (secs)  Data length (bytes)  Total messages received  Total data bytes received  Messages per sec  Data bytes per sec  Rx thread free delay (us)  Tx thread max get send buffer (us)  
            1.000005                    0                  2143743                          0           2143732                   0                         10                                  19  
            1.000302                   16                    94033                    1504528             94005             1504074                      10000                                9998  
            1.000004                    0                  2121659                          0           2121650                   0  
            1.000009                    1                  1826755                    1826755           1826738             1826738  
            1.000007                    2                  1826766                    3653532           1826754             3653507  
            1.000004                    4                  1828603                    7314412           1828596             7314385  
            1.000007                    8                  1821538                   14572304           1821525            14572202  
            1.000008                   16                  1820297                   29124752           1820282            29124506  
            1.000009                   32                  1691348                   54123136           1691334            54122673  
            1.000009                   64                  1634851                  104630464           1634836           104629481  
            1.000010                  128                  1580285                  202276480           1580269           202274400  
            1.000008                  256                  1594478                  408186368           1594465           408182961  
            1.000011                  512                  1479223                  757362176           1479206           757353701  
            1.000027                 1024                  1197202                 1225934848           1197169          1225901196  
            1.000031                 2048                   833488                 1706983424            833462          1706931170  
            1.000058                 4096                   522678                 2140889088            522648          2140764680  
            1.000102                 8192                   311307                 2550226944            311275          2549966883  
            1.000210                16384                   154665                 2534031360            154633          2533500432  
            1.000414                32768                    76641                 2511372288             76609          2510332674  
            1.000809                65536                    40348                 2644246528             40315          2642109252  
            1.001578               131072                    20603                 2700476416             20571          2696221493  
            1.003185               262144                    10430                 2734161920             10397          2725480010  
            1.006202               524288                     5258                 2756706304              5226          2739715838  
            1.012506              1048576                     2653                 2781872128              2620          2747511716  
            1.024605              2097152                     1344                 2818572288              1312          2750887469  
            1.049914              4194304                      689                 2889875456               656          2752486682  
            1.099836              8388608                      361                 3028287488               328          2753399878  
            1.200455             16777216                      197                 3305111552               164          2753215993  

Testing using sender using RDMA write with immediate and the receiver polling the CQ
sender_qp capabilities: max_send_wr=95 max_recv_wr=32 max_send_sge=2 max_recv_sge=1 max_inline_data=28
receiver_qp capabilities: max_send_wr=95 max_recv_wr=32 max_send_sge=2 max_recv_sge=1 max_inline_data=28
Changes to statistics for initialisation of Infiniband communications:
  Num voluntary context switches = 40 (159 -> 199)
  Num page reclaims = 1550 (1682 -> 3232)
  Num page faults = 0 (0 -> 0)
  Num mlx4 interrupts = 40 (8449 -> 8489)

Changes to statistics for Infiniband single thread message transfers:
  Num voluntary context switches = 0 (199 -> 199)
  Num page reclaims = 0 (3232 -> 3232)
  Num page faults = 0 (0 -> 0)
  Num mlx4 interrupts = 0 (8489 -> 8489)

Changes to statistics for Infiniband multi-threaded message transfers:
  Num voluntary context switches = 84 (199 -> 283)
  Num page reclaims = 0 (3232 -> 3232)
  Num page faults = 0 (0 -> 0)
  Num mlx4 interrupts = 35 (8489 -> 8524)


Test duration (secs)  Data length (bytes)  Total messages received  Total data bytes received  Messages per sec  Data bytes per sec  Rx thread free delay (us)  Tx thread max get send buffer (us)  
            1.000011                    0                   965723                          0            965712                   0                         10                                  33  
            1.006479                   16                    90033                    1440528             89453             1431254                      10000                               10002  
            0.999999                    0                  1014231                          0           1014232                   0  
            1.000015                    1                  1019967                    1019967           1019952             1019952  
            1.000010                    2                  1026632                    2053264           1026622             2053244  
            1.000020                    4                  1018846                    4075384           1018825             4075301  
            1.000037                    8                  1024970                    8199760           1024932             8199459  
            1.000021                   16                   938733                   15019728            938713            15019410  
            1.000020                   32                   897300                   28713600            897282            28713029  
            1.000014                   64                   984145                   62985280            984131            62984367  
            1.000028                  128                   944077                  120841856            944050           120838421  
            1.000016                  256                   899365                  230237440            899351           230233848  
            1.000034                  512                   883569                  452387328            883539           452371972  
            1.000017                 1024                   709673                  726705152            709661           726692667  
            1.000052                 2048                   541987                 1109989376            541959          1109931446  
            1.000069                 4096                   436287                 1787031552            436257          1786908352  
            1.000114                 8192                   277681                 2274762752            277649          2274504250  
            1.000218                16384                   144352                 2365063168            144321          2364547855  
            1.000424                32768                    75383                 2470150144             75351          2469103163  
            1.000850                65536                    39023                 2557411328             38990          2555240523  
            1.001604               131072                    20112                 2636120064             20080          2631897240  
            1.003178               262144                    10302                 2700607488             10269          2692052522  
            1.006253               524288                     5230                 2742026240              5198          2724987265  
            1.012303              1048576                     2647                 2775580672              2615          2741848965  
            1.024763              2097152                     1344                 2818572288              1312          2750461528  
            1.049175              4194304                      689                 2889875456               657          2754426051  
            1.098893              8388608                      361                 3028287488               329          2755762644  
            1.198169             16777216                      197                 3305111552               164          2758468530  



Results when not set CPU frequency and opensm stopped
=====================================================

$ sudo kill -STOP `pgrep opensm`

[1]+  Stopped                 sudo opensm
mr_halfword@Sandy-Ubuntu:~/ibv_message_passing$ ibv_functional_loopback_test/Release/ibv_functional_loopback_test 
Attributes of device mlx4_0:
 num_comp_vectors=8 fw_ver=2.9.1000
 node_guid=0x8c504b0003c90200 sys_image_guid=0x8f504b0003c90200
 max_mr_size=18446744073709551615 page_size_cap=4294966784 vendor_id=0x2c9 vendor_part_id=0x673c hw_ver=176
 max_qp=131000 max_qp_wr=16351 max_sge=32 max_sge_rd=30
device_cap_flags=IBV_DEVICE_BAD_PKEY_CNTR|IBV_DEVICE_BAD_QKEY_CNTR|IBV_DEVICE_AUTO_PATH_MIG|IBV_DEVICE_CHANGE_PHY_PORT|IBV_DEVICE_UD_AV_PORT_ENFORCE|IBV_DEVICE_PORT_ACTIVE_EVENT|IBV_DEVICE_SYS_IMAGE_GUID|IBV_DEVICE_RC_RNR_NAK_GEN|BIT15|IBV_DEVICE_IP_CSUM|BIT19|IBV_DEVICE_XRC|BIT21|BIT22|BIT26
 max_cq=65408 max_cqe=4194303 max_mr=524272 max_pd=32764
 max_qp_rd_atom=16 max_ee_rd_atom=0 max_res_rd_atom=2096000 max_qp_init_rd_atom=128
 max_ee_init_rd_atom=0 atomic_cap=IBV_ATOMIC_HCA
 max_ee=0 max_rdd=0 max_mw=0 max_raw_ipv6_qp=0 max_raw_ethy_qp=0
 max_mcast_grp=8192 max_mcast_qp_attach=248 max_total_mcast_qp_attach=2031616
 max_ah=0 max_fmr=0 max_map_per_fmr=8191 max_srq=65472 max_srq_wr=16383
 max_srq_sge=31 max_pkeys=128 local_ca_ack_delay=15 phys_port_cnt=2
Attributes of source port 1:
 state=IBV_PORT_ACTIVE max_mtu=IBV_MTU_4096 active_mtu=IBV_MTU_4096
 gid_tbl_len=128 port_cap_flags=0x251086a max_msg_sz=1073741824
 bad_pkey_cntr=0 qkey_viol_cntr=0 pkey_tbl_len=128 lid=1 sm_lid=1
 lmc=0 max_vl_num=3 sm_sl=0 subnet_timeout=18 init_type_reply=0
 active_width=2 active_speed=4 phys_state=5 link_layer=IBV_LINK_LAYER_INFINIBAND
Attributes of destination port 2:
 state=IBV_PORT_ACTIVE max_mtu=IBV_MTU_4096 active_mtu=IBV_MTU_4096
 gid_tbl_len=128 port_cap_flags=0x2510868 max_msg_sz=1073741824
 bad_pkey_cntr=0 qkey_viol_cntr=0 pkey_tbl_len=128 lid=2 sm_lid=1
 lmc=0 max_vl_num=3 sm_sl=0 subnet_timeout=18 init_type_reply=0
 active_width=2 active_speed=4 phys_state=5 link_layer=IBV_LINK_LAYER_INFINIBAND

Testing using sender using RDMA write and the receiver passive
message_send_qp capabilities: max_send_wr=223 max_recv_wr=1 max_send_sge=2 max_recv_sge=1 max_inline_data=28
freed_sequence_number_qp capabilities: max_send_wr=95 max_recv_wr=1 max_send_sge=2 max_recv_sge=1 max_inline_data=28
Changes to statistics for initialisation of Infiniband communications:
  Num voluntary context switches = 38 (10 -> 48)
  Num page reclaims = 1555 (124 -> 1679)
  Num page faults = 0 (0 -> 0)
  Num mlx4 interrupts = 38 (8211 -> 8249)

Changes to statistics for Infiniband single thread message transfers:
  Num voluntary context switches = 0 (48 -> 48)
  Num page reclaims = 0 (1680 -> 1680)
  Num page faults = 0 (0 -> 0)
  Num mlx4 interrupts = 0 (8249 -> 8249)

Changes to statistics for Infiniband multi-threaded message transfers:
  Num voluntary context switches = 84 (48 -> 132)
  Num page reclaims = 0 (1680 -> 1680)
  Num page faults = 0 (0 -> 0)
  Num mlx4 interrupts = 0 (8249 -> 8249)


Test duration (secs)  Data length (bytes)  Total messages received  Total data bytes received  Messages per sec  Data bytes per sec  Rx thread free delay (us)  Tx thread max get send buffer (us)  
            0.999995                    0                  2141367                          0           2141378                   0                         10                                  84  
            1.000345                   16                    94033                    1504528             94001             1504008                      10000                                9996  
            1.000005                    0                  2124414                          0           2124403                   0  
            1.000008                    1                  1815556                    1815556           1815541             1815541  
            1.000006                    2                  1814522                    3629044           1814511             3629022  
            1.000008                    4                  1814508                    7258032           1814494             7257977  
            1.000012                    8                  1808085                   14464680           1808064            14464512  
            1.000012                   16                  1797993                   28767888           1797972            28767552  
            1.000010                   32                  1698733                   54359456           1698716            54358916  
            1.000010                   64                  1644258                  105232512           1644242           105231458  
            1.000011                  128                  1590331                  203562368           1590313           203560043  
            1.000012                  256                  1599572                  409490432           1599553           409485684  
            1.000012                  512                  1487677                  761690624           1487659           761681418  
            1.000026                 1024                  1203471                 1232354304           1203440          1232322533  
            1.000035                 2048                   833559                 1707128832            833530          1707068576  
            1.000056                 4096                   528726                 2165661696            528697          2165541186  
            1.000098                 8192                   314755                 2578472960            314724          2578219877  
            1.000202                16384                   157675                 2583347200            157643          2582825358  
            1.000417                32768                    76383                 2502918144             76351          2501874860  
            1.000816                65536                    39345                 2578513920             39313          2576410796  
            1.001635               131072                    20030                 2625372160             19997          2621086840  
            1.003159               262144                    10286                 2696413184             10254          2687921620  
            1.006357               524288                     5227                 2740453376              5194          2723141410  
            1.012543              1048576                     2647                 2775580672              2614          2741198986  
            1.024725              2097152                     1343                 2816475136              1311          2748518776  
            1.049521              4194304                      689                 2889875456               656          2753518455  
            1.098669              8388608                      361                 3028287488               329          2756323858  
            1.198688             16777216                      197                 3305111552               164          2757273991  

Testing using sender using RDMA write with immediate and the receiver polling the CQ
sender_qp capabilities: max_send_wr=95 max_recv_wr=32 max_send_sge=2 max_recv_sge=1 max_inline_data=28
receiver_qp capabilities: max_send_wr=95 max_recv_wr=32 max_send_sge=2 max_recv_sge=1 max_inline_data=28
Changes to statistics for initialisation of Infiniband communications:
  Num voluntary context switches = 40 (159 -> 199)
  Num page reclaims = 1550 (1681 -> 3231)
  Num page faults = 0 (0 -> 0)
  Num mlx4 interrupts = 40 (8271 -> 8311)

Changes to statistics for Infiniband single thread message transfers:
  Num voluntary context switches = 0 (199 -> 199)
  Num page reclaims = 0 (3231 -> 3231)
  Num page faults = 0 (0 -> 0)
  Num mlx4 interrupts = 0 (8311 -> 8311)

Changes to statistics for Infiniband multi-threaded message transfers:
  Num voluntary context switches = 84 (199 -> 283)
  Num page reclaims = 0 (3231 -> 3231)
  Num page faults = 0 (0 -> 0)
  Num mlx4 interrupts = 0 (8311 -> 8311)


Test duration (secs)  Data length (bytes)  Total messages received  Total data bytes received  Messages per sec  Data bytes per sec  Rx thread free delay (us)  Tx thread max get send buffer (us)  
            1.000012                    0                   961025                          0            961014                   0                         10                                 148  
            1.005612                   16                    90033                    1440528             89531             1432489                      10000                               10002  
            1.000013                    0                   999091                          0            999078                   0  
            1.000027                    1                  1014438                    1014438           1014411             1014411  
            1.000020                    2                  1012123                    2024246           1012103             2024206  
            1.000013                    4                  1014927                    4059708           1014913             4059654  
            1.000010                    8                  1017009                    8136072           1016998             8135988  
            1.000026                   16                   942704                   15083264            942679            15082871  
            1.000032                   32                   948334                   30346688            948304            30345722  
            1.000033                   64                   930475                   59550400            930444            59548417  
            1.000019                  128                   949143                  121490304            949125           121487972  
            1.000020                  256                   896906                  229607936            896888           229603333  
            1.000020                  512                   887516                  454408192            887499           454399316  
            1.000027                 1024                   678111                  694385664            678092           694366665  
            1.000033                 2048                   631521                 1293355008            631500          1293312045  
            1.000084                 4096                   437485                 1791938560            437448          1791787204  
            1.000118                 8192                   277052                 2269609984            277019          2269342980  
            1.000222                16384                   144383                 2365571072            144351          2365047197  
            1.000429                32768                    75272                 2466512896             75240          2465456357  
            1.000842                65536                    39129                 2564358144             39096          2562201549  
            1.001645               131072                    20128                 2638217216             20095          2633883185  
            1.003216               262144                    10308                 2702180352             10275          2693518769  
            1.006313               524288                     5233                 2743599104              5200          2726386735  
            1.012602              1048576                     2649                 2777677824              2616          2743110455  
            1.025083              2097152                     1345                 2820669440              1312          2751649483  
            1.048908              4194304                      689                 2889875456               657          2755127522  
            1.098143              8388608                      361                 3028287488               329          2757645260  
            1.198154             16777216                      197                 3305111552               164          2758501984  

This shows that opensm is stopped running the number of mlx4 interrupts during the message transfer tests changes
from a few tens to zero. i.e. the message transfer tests are not causing any mlx4 interrupts themselves.
