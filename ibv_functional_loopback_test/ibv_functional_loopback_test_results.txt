Results when not set CPU frequency and opensm running
=====================================================

$ ibv_functional_loopback_test/Release/ibv_functional_loopback_test 
Attributes of device mlx4_0:
 num_comp_vectors=8 fw_ver=2.9.1000
 node_guid=0x8c504b0003c90200 sys_image_guid=0x8f504b0003c90200
 max_mr_size=18446744073709551615 page_size_cap=4294966784 vendor_id=0x2c9 vendor_part_id=0x673c hw_ver=176
 max_qp=131000 max_qp_wr=16351 max_sge=32 max_sge_rd=30
device_cap_flags=IBV_DEVICE_BAD_PKEY_CNTR|IBV_DEVICE_BAD_QKEY_CNTR|IBV_DEVICE_AUTO_PATH_MIG|IBV_DEVICE_CHANGE_PHY_PORT|IBV_DEVICE_UD_AV_PORT_ENFORCE|IBV_DEVICE_PORT_ACTIVE_EVENT|IBV_DEVICE_SYS_IMAGE_GUID|IBV_DEVICE_RC_RNR_NAK_GEN|BIT15|IBV_DEVICE_IP_CSUM|BIT19|IBV_DEVICE_XRC|BIT21|BIT22|BIT26
 max_cq=65408 max_cqe=4194303 max_mr=524272 max_pd=32764
 max_qp_rd_atom=16 max_ee_rd_atom=0 max_res_rd_atom=2096000 max_qp_init_rd_atom=128
 max_ee_init_rd_atom=0 atomic_cap=IBV_ATOMIC_HCA
 max_ee=0 max_rdd=0 max_mw=0 max_raw_ipv6_qp=0 max_raw_ethy_qp=0
 max_mcast_grp=8192 max_mcast_qp_attach=248 max_total_mcast_qp_attach=2031616
 max_ah=0 max_fmr=0 max_map_per_fmr=8191 max_srq=65472 max_srq_wr=16383
 max_srq_sge=31 max_pkeys=128 local_ca_ack_delay=15 phys_port_cnt=2
Attributes of source port 1:
 state=IBV_PORT_ACTIVE max_mtu=IBV_MTU_4096 active_mtu=IBV_MTU_4096
 gid_tbl_len=128 port_cap_flags=0x251086a max_msg_sz=1073741824
 bad_pkey_cntr=0 qkey_viol_cntr=0 pkey_tbl_len=128 lid=1 sm_lid=1
 lmc=0 max_vl_num=3 sm_sl=0 subnet_timeout=18 init_type_reply=0
 active_width=2 active_speed=4 phys_state=5 link_layer=IBV_LINK_LAYER_INFINIBAND
Attributes of destination port 2:
 state=IBV_PORT_ACTIVE max_mtu=IBV_MTU_4096 active_mtu=IBV_MTU_4096
 gid_tbl_len=128 port_cap_flags=0x2510868 max_msg_sz=1073741824
 bad_pkey_cntr=0 qkey_viol_cntr=0 pkey_tbl_len=128 lid=2 sm_lid=1
 lmc=0 max_vl_num=3 sm_sl=0 subnet_timeout=18 init_type_reply=0
 active_width=2 active_speed=4 phys_state=5 link_layer=IBV_LINK_LAYER_INFINIBAND

Testing using sender using RDMA write and the receiver passive
message_send_qp capabilities: max_send_wr=95 max_recv_wr=1 max_send_sge=2 max_recv_sge=1 max_inline_data=28
freed_sequence_number_qp capabilities: max_send_wr=95 max_recv_wr=1 max_send_sge=2 max_recv_sge=1 max_inline_data=28
Changes to statistics for initialisation of Infiniband communications:
  Num voluntary context switches = 38 (10 -> 48)
  Num page reclaims = 1553 (124 -> 1677)
  Num page faults = 0 (0 -> 0)
  Num mlx4 interrupts = 38 (5214 -> 5252)

Changes to statistics for Infiniband single thread message transfers:
  Num voluntary context switches = 0 (48 -> 48)
  Num page reclaims = 0 (1677 -> 1677)
  Num page faults = 0 (0 -> 0)
  Num mlx4 interrupts = 0 (5252 -> 5252)

Changes to statistics for Infiniband multi-threaded message transfers:
  Num voluntary context switches = 84 (48 -> 132)
  Num page reclaims = 0 (1677 -> 1677)
  Num page faults = 0 (0 -> 0)
  Num mlx4 interrupts = 35 (5252 -> 5287)


Test duration (secs)  Data length (bytes)  Total messages received  Total data bytes received  Messages per sec  Data bytes per sec  Rx thread free delay (us)  Tx thread max get send buffer (us)  
            1.000006                    0                  2029949                          0           2029938                   0                         10                                  23  
            1.009839                   16                    95033                    1520528             94107             1505713                      10000                                9996  
            1.000004                    0                  2028624                          0           2028615                   0  
            1.000007                    1                  1865946                    1865946           1865934             1865934  
            1.000004                    2                  1867232                    3734464           1867225             3734451  
            1.000007                    4                  1867067                    7468268           1867054             7468215  
            1.000008                    8                  1865144                   14921152           1865129            14921034  
            1.000008                   16                  1860499                   29767984           1860485            29767758  
            1.000008                   32                  1688431                   54029792           1688417            54029348  
            1.000009                   64                  1642148                  105097472           1642134           105096564  
            1.000007                  128                  1586379                  203056512           1586368           203055047  
            1.000009                  256                  1591026                  407302656           1591012           407298999  
            1.000009                  512                  1504086                  770092032           1504073           770085457  
            1.000020                 1024                  1190436                 1219006464           1190412          1218981908  
            1.000034                 2048                   823702                 1686941696            823674          1686884502  
            1.000053                 4096                   522566                 2140430336            522538          2140317436  
            1.000099                 8192                   308481                 2527076352            308451          2526827171  
            1.000205                16384                   153512                 2515140608            153481          2514624967  
            1.000413                32768                    76229                 2497871872             76198          2496839721  
            1.000824                65536                    39282                 2574385152             39250          2572266759  
            1.001602               131072                    20014                 2623275008             19982          2619079136  
            1.003169               262144                    10281                 2695102464             10249          2686588255  
            1.006161               524288                     5225                 2739404800              5193          2722630377  
            1.012283              1048576                     2646                 2774532096              2614          2740864823  
            1.024625              2097152                     1343                 2816475136              1311          2748785442  
            1.049718              4194304                      689                 2889875456               656          2753001087  
            1.098756              8388608                      361                 3028287488               329          2756105407  
            1.198679             16777216                      197                 3305111552               164          2757296046  

Testing using sender using RDMA write with immediate and the receiver polling the CQ
sender_qp capabilities: max_send_wr=95 max_recv_wr=32 max_send_sge=2 max_recv_sge=1 max_inline_data=28
receiver_qp capabilities: max_send_wr=95 max_recv_wr=32 max_send_sge=2 max_recv_sge=1 max_inline_data=28
Changes to statistics for initialisation of Infiniband communications:
  Num voluntary context switches = 40 (160 -> 200)
  Num page reclaims = 1550 (1678 -> 3228)
  Num page faults = 0 (0 -> 0)
  Num mlx4 interrupts = 40 (5309 -> 5349)

Changes to statistics for Infiniband single thread message transfers:
  Num voluntary context switches = 0 (200 -> 200)
  Num page reclaims = 0 (3229 -> 3229)
  Num page faults = 0 (0 -> 0)
  Num mlx4 interrupts = 0 (5349 -> 5349)

Changes to statistics for Infiniband multi-threaded message transfers:
  Num voluntary context switches = 84 (200 -> 284)
  Num page reclaims = 0 (3229 -> 3229)
  Num page faults = 0 (0 -> 0)
  Num mlx4 interrupts = 35 (5349 -> 5384)


Test duration (secs)  Data length (bytes)  Total messages received  Total data bytes received  Messages per sec  Data bytes per sec  Rx thread free delay (us)  Tx thread max get send buffer (us)  
            1.000013                    0                   966325                          0            966312                   0                         10                                  34  
            1.006921                   16                    90033                    1440528             89414             1430626                      10000                               10001  
            1.000029                    0                  1007232                          0           1007202                   0  
            1.000030                    1                  1013404                    1013404           1013374             1013374  
            1.000026                    2                  1011616                    2023232           1011589             2023179  
            1.000022                    4                  1019454                    4077816           1019432             4077727  
            1.000031                    8                  1012674                    8101392           1012643             8101140  
            1.000022                   16                  1005526                   16088416           1005504            16088069  
            1.000031                   32                   970216                   31046912            970186            31045956  
            1.000028                   64                   994386                   63640704            994358            63638920  
            1.000028                  128                   924510                  118337280            924484           118333912  
            1.000038                  256                   920271                  235589376            920236           235580324  
            1.000022                  512                   861344                  441008128            861325           440998433  
            1.000019                 1024                   747448                  765386752            747434           765372179  
            1.000047                 2048                   601818                 1232523264            601790          1232465236  
            1.000075                 4096                   388964                 1593196544            388935          1593077484  
            1.000102                 8192                   276930                 2268610560            276902          2268378625  
            1.000218                16384                   144570                 2368634880            144539          2368119345  
            1.000429                32768                    74144                 2429550592             74112          2428509657  
            1.000823                65536                    39092                 2561933312             39060          2559827467  
            1.001618               131072                    20149                 2640969728             20116          2636704581  
            1.003133               262144                    10312                 2703228928             10280          2694784922  
            1.006301               524288                     5234                 2744123392              5201          2726941606  
            1.012311              1048576                     2649                 2777677824              2617          2743896572  
            1.025139              2097152                     1345                 2820669440              1312          2751499365  
            1.050241              4194304                      690                 2894069760               657          2755624338  
            1.098396              8388608                      361                 3028287488               329          2757008587  
            1.197757             16777216                      197                 3305111552               164          2759417069  



Results when not set CPU frequency and opensm stopped
=====================================================

$ sudo kill -STOP `pgrep opensm`

[1]+  Stopped                 sudo opensm
mr_halfword@Sandy-Ubuntu:~/ibv_message_passing$ ibv_functional_loopback_test/Release/ibv_functional_loopback_test 
Attributes of device mlx4_0:
 num_comp_vectors=8 fw_ver=2.9.1000
 node_guid=0x8c504b0003c90200 sys_image_guid=0x8f504b0003c90200
 max_mr_size=18446744073709551615 page_size_cap=4294966784 vendor_id=0x2c9 vendor_part_id=0x673c hw_ver=176
 max_qp=131000 max_qp_wr=16351 max_sge=32 max_sge_rd=30
device_cap_flags=IBV_DEVICE_BAD_PKEY_CNTR|IBV_DEVICE_BAD_QKEY_CNTR|IBV_DEVICE_AUTO_PATH_MIG|IBV_DEVICE_CHANGE_PHY_PORT|IBV_DEVICE_UD_AV_PORT_ENFORCE|IBV_DEVICE_PORT_ACTIVE_EVENT|IBV_DEVICE_SYS_IMAGE_GUID|IBV_DEVICE_RC_RNR_NAK_GEN|BIT15|IBV_DEVICE_IP_CSUM|BIT19|IBV_DEVICE_XRC|BIT21|BIT22|BIT26
 max_cq=65408 max_cqe=4194303 max_mr=524272 max_pd=32764
 max_qp_rd_atom=16 max_ee_rd_atom=0 max_res_rd_atom=2096000 max_qp_init_rd_atom=128
 max_ee_init_rd_atom=0 atomic_cap=IBV_ATOMIC_HCA
 max_ee=0 max_rdd=0 max_mw=0 max_raw_ipv6_qp=0 max_raw_ethy_qp=0
 max_mcast_grp=8192 max_mcast_qp_attach=248 max_total_mcast_qp_attach=2031616
 max_ah=0 max_fmr=0 max_map_per_fmr=8191 max_srq=65472 max_srq_wr=16383
 max_srq_sge=31 max_pkeys=128 local_ca_ack_delay=15 phys_port_cnt=2
Attributes of source port 1:
 state=IBV_PORT_ACTIVE max_mtu=IBV_MTU_4096 active_mtu=IBV_MTU_4096
 gid_tbl_len=128 port_cap_flags=0x251086a max_msg_sz=1073741824
 bad_pkey_cntr=0 qkey_viol_cntr=0 pkey_tbl_len=128 lid=1 sm_lid=1
 lmc=0 max_vl_num=3 sm_sl=0 subnet_timeout=18 init_type_reply=0
 active_width=2 active_speed=4 phys_state=5 link_layer=IBV_LINK_LAYER_INFINIBAND
Attributes of destination port 2:
 state=IBV_PORT_ACTIVE max_mtu=IBV_MTU_4096 active_mtu=IBV_MTU_4096
 gid_tbl_len=128 port_cap_flags=0x2510868 max_msg_sz=1073741824
 bad_pkey_cntr=0 qkey_viol_cntr=0 pkey_tbl_len=128 lid=2 sm_lid=1
 lmc=0 max_vl_num=3 sm_sl=0 subnet_timeout=18 init_type_reply=0
 active_width=2 active_speed=4 phys_state=5 link_layer=IBV_LINK_LAYER_INFINIBAND

Testing using sender using RDMA write and the receiver passive
message_send_qp capabilities: max_send_wr=95 max_recv_wr=1 max_send_sge=2 max_recv_sge=1 max_inline_data=28
freed_sequence_number_qp capabilities: max_send_wr=95 max_recv_wr=1 max_send_sge=2 max_recv_sge=1 max_inline_data=28
Changes to statistics for initialisation of Infiniband communications:
  Num voluntary context switches = 38 (10 -> 48)
  Num page reclaims = 1553 (122 -> 1675)
  Num page faults = 0 (0 -> 0)
  Num mlx4 interrupts = 38 (5460 -> 5498)

Changes to statistics for Infiniband single thread message transfers:
  Num voluntary context switches = 0 (48 -> 48)
  Num page reclaims = 0 (1675 -> 1675)
  Num page faults = 0 (0 -> 0)
  Num mlx4 interrupts = 0 (5498 -> 5498)

Changes to statistics for Infiniband multi-threaded message transfers:
  Num voluntary context switches = 84 (48 -> 132)
  Num page reclaims = 0 (1675 -> 1675)
  Num page faults = 0 (0 -> 0)
  Num mlx4 interrupts = 0 (5498 -> 5498)


Test duration (secs)  Data length (bytes)  Total messages received  Total data bytes received  Messages per sec  Data bytes per sec  Rx thread free delay (us)  Tx thread max get send buffer (us)  
            1.000004                    0                  2031447                          0           2031439                   0                         10                                  24  
            1.009435                   16                    95033                    1520528             94145             1506316                      10000                                9994  
            1.000005                    0                  2018728                          0           2018718                   0  
            1.000006                    1                  1879939                    1879939           1879928             1879928  
            1.000006                    2                  1878954                    3757908           1878943             3757885  
            1.000006                    4                  1878693                    7514772           1878682             7514728  
            1.000008                    8                  1874557                   14996456           1874543            14996341  
            1.000007                   16                  1869362                   29909792           1869348            29909575  
            1.000009                   32                  1696775                   54296800           1696760            54296317  
            1.000009                   64                  1653771                  105841344           1653756           105840405  
            1.000010                  128                  1595523                  204226944           1595507           204224895  
            1.000010                  256                  1592040                  407562240           1592025           407558333  
            1.000013                  512                  1501565                  768801280           1501546           768791314  
            1.000024                 1024                  1189604                 1218154496           1189576          1218125635  
            1.000034                 2048                   826166                 1691987968            826138          1691930052  
            1.000055                 4096                   521709                 2136920064            521680          2136802098  
            1.000104                 8192                   307530                 2519285760            307498          2519024958  
            1.000205                16384                   154160                 2525757440            154128          2525239342  
            1.000422                32768                    76323                 2500952064             76291          2499896795  
            1.000812                65536                    39437                 2584543232             39405          2582445225  
            1.001623               131072                    20297                 2660368384             20264          2656057321  
            1.003200               262144                    10363                 2716598272             10330          2707933189  
            1.006137               524288                     5246                 2750414848              5214          2733637495  
            1.012447              1048576                     2653                 2781872128              2620          2747671734  
            1.024921              2097152                     1346                 2822766592              1313          2754131718  
            1.049695              4194304                      690                 2894069760               657          2757057183  
            1.097704              8388608                      361                 3028287488               329          2758748036  
            1.198036             16777216                      197                 3305111552               164          2758775807  

Testing using sender using RDMA write with immediate and the receiver polling the CQ
sender_qp capabilities: max_send_wr=95 max_recv_wr=32 max_send_sge=2 max_recv_sge=1 max_inline_data=28
receiver_qp capabilities: max_send_wr=95 max_recv_wr=32 max_send_sge=2 max_recv_sge=1 max_inline_data=28
Changes to statistics for initialisation of Infiniband communications:
  Num voluntary context switches = 40 (159 -> 199)
  Num page reclaims = 1550 (1676 -> 3226)
  Num page faults = 0 (0 -> 0)
  Num mlx4 interrupts = 40 (5520 -> 5560)

Changes to statistics for Infiniband single thread message transfers:
  Num voluntary context switches = 0 (199 -> 199)
  Num page reclaims = 0 (3227 -> 3227)
  Num page faults = 0 (0 -> 0)
  Num mlx4 interrupts = 0 (5560 -> 5560)

Changes to statistics for Infiniband multi-threaded message transfers:
  Num voluntary context switches = 84 (199 -> 283)
  Num page reclaims = 0 (3227 -> 3227)
  Num page faults = 0 (0 -> 0)
  Num mlx4 interrupts = 0 (5560 -> 5560)


Test duration (secs)  Data length (bytes)  Total messages received  Total data bytes received  Messages per sec  Data bytes per sec  Rx thread free delay (us)  Tx thread max get send buffer (us)  
            1.000012                    0                   967833                          0            967821                   0                         10                                  38  
            1.006881                   16                    90033                    1440528             89418             1430683                      10000                               10002  
            1.000005                    0                  1008702                          0           1008697                   0  
            1.000017                    1                  1017801                    1017801           1017783             1017783  
            0.999999                    2                  1019909                    2039818           1019910             2039820  
            1.000022                    4                  1012078                    4048312           1012055             4048221  
            1.000028                    8                  1024947                    8199576           1024918             8199344  
            1.000037                   16                   945668                   15130688            945633            15130128  
            1.000027                   32                  1013171                   32421472           1013143            32420590  
            1.000042                   64                   949678                   60779392            949638            60776829  
            1.000023                  128                   890622                  113999616            890601           113996963  
            1.000032                  256                   889178                  227629568            889149           227622176  
            1.000025                  512                   894826                  458150912            894803           458139331  
            1.000037                 1024                   709353                  726377472            709327           726350754  
            1.000052                 2048                   590752                 1209860096            590721          1209797592  
            1.000070                 4096                   441073                 1806635008            441042          1806508393  
            1.000115                 8192                   278281                 2279677952            278249          2279416159  
            1.000219                16384                   144495                 2367406080            144463          2366888747  
            1.000433                32768                    73689                 2414641152             73657          2413595701  
            1.000845                65536                    39135                 2564751360             39102          2562587214  
            1.001628               131072                    20145                 2640445440             20112          2636154219  
            1.003111               262144                    10310                 2702704640             10278          2694323583  
            1.006233               524288                     5233                 2743599104              5201          2726605240  
            1.012438              1048576                     2649                 2777677824              2616          2743552931  
            1.025081              2097152                     1345                 2820669440              1312          2751655104  
            1.049244              4194304                      689                 2889875456               657          2754246601  
            1.098425              8388608                      361                 3028287488               329          2756936782  
            1.198089             16777216                      197                 3305111552               164          2758653458  

This shows that opensm is stopped running the number of mlx4 interrupts during the message transfer tests changes
from a few tens to zero. i.e. the message transfer tests are not causing any mlx4 interrupts themselves.
