Results when not set CPU frequency and opensm running
=====================================================

$ ibv_functional_loopback_test/Release/ibv_functional_loopback_test 
Attributes of device mlx4_0:
 num_comp_vectors=8 fw_ver=2.9.1000
 node_guid=0x8c504b0003c90200 sys_image_guid=0x8f504b0003c90200
 max_mr_size=18446744073709551615 page_size_cap=4294966784 vendor_id=0x2c9 vendor_part_id=0x673c hw_ver=176
 max_qp=131000 max_qp_wr=16351 max_sge=32 max_sge_rd=30
device_cap_flags=IBV_DEVICE_BAD_PKEY_CNTR|IBV_DEVICE_BAD_QKEY_CNTR|IBV_DEVICE_AUTO_PATH_MIG|IBV_DEVICE_CHANGE_PHY_PORT|IBV_DEVICE_UD_AV_PORT_ENFORCE|IBV_DEVICE_PORT_ACTIVE_EVENT|IBV_DEVICE_SYS_IMAGE_GUID|IBV_DEVICE_RC_RNR_NAK_GEN|BIT15|IBV_DEVICE_IP_CSUM|BIT19|IBV_DEVICE_XRC|BIT21|BIT22|BIT26
 max_cq=65408 max_cqe=4194303 max_mr=524272 max_pd=32764
 max_qp_rd_atom=16 max_ee_rd_atom=0 max_res_rd_atom=2096000 max_qp_init_rd_atom=128
 max_ee_init_rd_atom=0 atomic_cap=IBV_ATOMIC_HCA
 max_ee=0 max_rdd=0 max_mw=0 max_raw_ipv6_qp=0 max_raw_ethy_qp=0
 max_mcast_grp=8192 max_mcast_qp_attach=248 max_total_mcast_qp_attach=2031616
 max_ah=0 max_fmr=0 max_map_per_fmr=8191 max_srq=65472 max_srq_wr=16383
 max_srq_sge=31 max_pkeys=128 local_ca_ack_delay=15 phys_port_cnt=2
Attributes of source port 1:
 state=IBV_PORT_ACTIVE max_mtu=IBV_MTU_4096 active_mtu=IBV_MTU_4096
 gid_tbl_len=128 port_cap_flags=0x251086a max_msg_sz=1073741824
 bad_pkey_cntr=0 qkey_viol_cntr=0 pkey_tbl_len=128 lid=1 sm_lid=1
 lmc=0 max_vl_num=3 sm_sl=0 subnet_timeout=18 init_type_reply=0
 active_width=2 active_speed=4 phys_state=5 link_layer=IBV_LINK_LAYER_INFINIBAND
Attributes of destination port 2:
 state=IBV_PORT_ACTIVE max_mtu=IBV_MTU_4096 active_mtu=IBV_MTU_4096
 gid_tbl_len=128 port_cap_flags=0x2510868 max_msg_sz=1073741824
 bad_pkey_cntr=0 qkey_viol_cntr=0 pkey_tbl_len=128 lid=2 sm_lid=1
 lmc=0 max_vl_num=3 sm_sl=0 subnet_timeout=18 init_type_reply=0
 active_width=2 active_speed=4 phys_state=5 link_layer=IBV_LINK_LAYER_INFINIBAND

Testing using sender using RDMA write and the receiver passive
message_send_qp capabilities: max_send_wr=95 max_recv_wr=1 max_send_sge=2 max_recv_sge=1 max_inline_data=28
freed_sequence_number_qp capabilities: max_send_wr=95 max_recv_wr=1 max_send_sge=2 max_recv_sge=1 max_inline_data=28
Changes to statistics for initialisation of Infiniband communications:
  Num voluntary context switches = 38 (10 -> 48)
  Num page reclaims = 1553 (124 -> 1677)
  Num page faults = 0 (0 -> 0)
  Num mlx4 interrupts = 38 (44191 -> 44229)

Changes to statistics for Infiniband single thread message transfers:
  Num voluntary context switches = 0 (48 -> 48)
  Num page reclaims = 0 (1677 -> 1677)
  Num page faults = 0 (0 -> 0)
  Num mlx4 interrupts = 12 (44229 -> 44241)

Changes to statistics for Infiniband multi-threaded message transfers:
  Num voluntary context switches = 84 (48 -> 132)
  Num page reclaims = 0 (1677 -> 1677)
  Num page faults = 0 (0 -> 0)
  Num mlx4 interrupts = 24 (44241 -> 44265)


Test duration (secs)  Data length (bytes)  Total messages received  Total data bytes received  Messages per sec  Data bytes per sec  Rx thread free delay (us)  Tx thread max get send buffer (us)  
            1.000008                    0                  1788778                          0           1788764                   0                         10                                 293  
            1.000015                   16                    93305                    1492880             93304             1492858                      10000                                9999  
            1.000009                    0                  1773113                          0           1773097                   0  
            1.000012                    1                  1531222                    1531222           1531203             1531203  
            1.000014                    2                  1531611                    3063222           1531590             3063181  
            1.000014                    4                  1534268                    6137072           1534246             6136985  
            1.000017                    8                  1532681                   12261448           1532655            12261243  
            1.000016                   16                  1531122                   24497952           1531097            24497556  
            1.000015                   32                  1515275                   48488800           1515252            48488065  
            1.000013                   64                  1493032                   95554048           1493013            95552839  
            1.000016                  128                  1469733                  188125824           1469710           188122825  
            1.000019                  256                  1451795                  371659520           1451768           371652531  
            1.000024                  512                  1298276                  664717312           1298244           664701028  
            1.000029                 1024                  1024228                 1048809472           1024198          1048779075  
            1.000040                 2048                   749693                 1535371264            749663          1535310025  
            1.000062                 4096                   493938                 2023170048            493907          2023044257  
            1.000104                 8192                   306104                 2507603968            306072          2507344137  
            1.000200                16384                   150441                 2464825344            150411          2464333111  
            1.000426                32768                    73331                 2402910208             73300          2401887828  
            1.000812                65536                    38916                 2550398976             38884          2548329898  
            1.001619               131072                    20066                 2630090752             20034          2625840674  
            1.003191               262144                    10291                 2697723904             10258          2689143286  
            1.006161               524288                     5227                 2740453376              5195          2723672032  
            1.012290              1048576                     2645                 2773483520              2613          2739811270  
            1.025074              2097152                     1343                 2816475136              1310          2747582591  
            1.048861              4194304                      688                 2885681152               656          2751252863  
            1.099973              8388608                      361                 3028287488               328          2753055960  
            1.198901             16777216                      197                 3305111552               164          2756784014  

Testing using sender using RDMA write with immediate and the receiver polling the CQ
sender_qp capabilities: max_send_wr=95 max_recv_wr=32 max_send_sge=2 max_recv_sge=1 max_inline_data=28
receiver_qp capabilities: max_send_wr=95 max_recv_wr=32 max_send_sge=2 max_recv_sge=1 max_inline_data=28
Changes to statistics for initialisation of Infiniband communications:
  Num voluntary context switches = 40 (160 -> 200)
  Num page reclaims = 1550 (1679 -> 3229)
  Num page faults = 0 (0 -> 0)
  Num mlx4 interrupts = 40 (44287 -> 44327)

Changes to statistics for Infiniband single thread message transfers:
  Num voluntary context switches = 0 (200 -> 200)
  Num page reclaims = 0 (3230 -> 3230)
  Num page faults = 0 (0 -> 0)
  Num mlx4 interrupts = 11 (44327 -> 44338)

Changes to statistics for Infiniband multi-threaded message transfers:
  Num voluntary context switches = 84 (200 -> 284)
  Num page reclaims = 0 (3230 -> 3230)
  Num page faults = 0 (0 -> 0)
  Num mlx4 interrupts = 35 (44338 -> 44373)


Test duration (secs)  Data length (bytes)  Total messages received  Total data bytes received  Messages per sec  Data bytes per sec  Rx thread free delay (us)  Tx thread max get send buffer (us)  
            1.000002                    0                   973597                          0            973595                   0                         10                                  39  
            1.005855                   16                    90033                    1440528             89509             1432143                      10000                               10002  
            1.000012                    0                  1011419                          0           1011407                   0  
            1.000013                    1                  1012681                    1012681           1012668             1012668  
            1.000008                    2                  1010093                    2020186           1010085             2020170  
            1.000014                    4                  1012055                    4048220           1012041             4048164  
            1.000015                    8                  1014993                    8119944           1014978             8119823  
            1.000034                   16                   993377                   15894032            993343            15893486  
            1.000021                   32                   962291                   30793312            962271            30792680  
            1.000029                   64                   977100                   62534400            977072            62532597  
            1.000044                  128                   952249                  121887872            952207           121882488  
            1.000023                  256                   918502                  235136512            918481           235131075  
            1.000030                  512                   846742                  433531904            846716           433518784  
            1.000040                 1024                   720559                  737852416            720530           737822584  
            1.000035                 2048                   622614                 1275113472            622592          1275069200  
            1.000075                 4096                   436661                 1788563456            436628          1788429885  
            1.000122                 8192                   269393                 2206867456            269360          2206598666  
            1.000221                16384                   144424                 2366242816            144392          2365720458  
            1.000427                32768                    75602                 2477326336             75570          2476269900  
            1.000817                65536                    39110                 2563112960             39078          2561020089  
            1.001647               131072                    20119                 2637037568             20086          2632701267  
            1.003195               262144                    10297                 2699296768             10264          2690699963  
            1.006198               524288                     5228                 2740977664              5196          2724093422  
            1.012413              1048576                     2646                 2774532096              2614          2740513039  
            1.024725              2097152                     1343                 2816475136              1311          2748516727  
            1.050077              4194304                      689                 2889875456               656          2752061080  
            1.099745              8388608                      361                 3028287488               328          2753627803  
            1.199141             16777216                      197                 3305111552               164          2756232218  


Results when not set CPU frequency and opensm stopped
=====================================================

$ sudo kill -STOP `pgrep opensm`
[sudo] password for mr_halfword: 

[1]+  Stopped                 sudo opensm
mr_halfword@Sandy-Ubuntu:~/ibv_message_passing$ ibv_functional_loopback_test/Release/ibv_functional_loopback_test 
Attributes of device mlx4_0:
 num_comp_vectors=8 fw_ver=2.9.1000
 node_guid=0x8c504b0003c90200 sys_image_guid=0x8f504b0003c90200
 max_mr_size=18446744073709551615 page_size_cap=4294966784 vendor_id=0x2c9 vendor_part_id=0x673c hw_ver=176
 max_qp=131000 max_qp_wr=16351 max_sge=32 max_sge_rd=30
device_cap_flags=IBV_DEVICE_BAD_PKEY_CNTR|IBV_DEVICE_BAD_QKEY_CNTR|IBV_DEVICE_AUTO_PATH_MIG|IBV_DEVICE_CHANGE_PHY_PORT|IBV_DEVICE_UD_AV_PORT_ENFORCE|IBV_DEVICE_PORT_ACTIVE_EVENT|IBV_DEVICE_SYS_IMAGE_GUID|IBV_DEVICE_RC_RNR_NAK_GEN|BIT15|IBV_DEVICE_IP_CSUM|BIT19|IBV_DEVICE_XRC|BIT21|BIT22|BIT26
 max_cq=65408 max_cqe=4194303 max_mr=524272 max_pd=32764
 max_qp_rd_atom=16 max_ee_rd_atom=0 max_res_rd_atom=2096000 max_qp_init_rd_atom=128
 max_ee_init_rd_atom=0 atomic_cap=IBV_ATOMIC_HCA
 max_ee=0 max_rdd=0 max_mw=0 max_raw_ipv6_qp=0 max_raw_ethy_qp=0
 max_mcast_grp=8192 max_mcast_qp_attach=248 max_total_mcast_qp_attach=2031616
 max_ah=0 max_fmr=0 max_map_per_fmr=8191 max_srq=65472 max_srq_wr=16383
 max_srq_sge=31 max_pkeys=128 local_ca_ack_delay=15 phys_port_cnt=2
Attributes of source port 1:
 state=IBV_PORT_ACTIVE max_mtu=IBV_MTU_4096 active_mtu=IBV_MTU_4096
 gid_tbl_len=128 port_cap_flags=0x251086a max_msg_sz=1073741824
 bad_pkey_cntr=0 qkey_viol_cntr=0 pkey_tbl_len=128 lid=1 sm_lid=1
 lmc=0 max_vl_num=3 sm_sl=0 subnet_timeout=18 init_type_reply=0
 active_width=2 active_speed=4 phys_state=5 link_layer=IBV_LINK_LAYER_INFINIBAND
Attributes of destination port 2:
 state=IBV_PORT_ACTIVE max_mtu=IBV_MTU_4096 active_mtu=IBV_MTU_4096
 gid_tbl_len=128 port_cap_flags=0x2510868 max_msg_sz=1073741824
 bad_pkey_cntr=0 qkey_viol_cntr=0 pkey_tbl_len=128 lid=2 sm_lid=1
 lmc=0 max_vl_num=3 sm_sl=0 subnet_timeout=18 init_type_reply=0
 active_width=2 active_speed=4 phys_state=5 link_layer=IBV_LINK_LAYER_INFINIBAND

Testing using sender using RDMA write and the receiver passive
message_send_qp capabilities: max_send_wr=95 max_recv_wr=1 max_send_sge=2 max_recv_sge=1 max_inline_data=28
freed_sequence_number_qp capabilities: max_send_wr=95 max_recv_wr=1 max_send_sge=2 max_recv_sge=1 max_inline_data=28
Changes to statistics for initialisation of Infiniband communications:
  Num voluntary context switches = 38 (10 -> 48)
  Num page reclaims = 1553 (124 -> 1677)
  Num page faults = 0 (0 -> 0)
  Num mlx4 interrupts = 38 (44539 -> 44577)

Changes to statistics for Infiniband single thread message transfers:
  Num voluntary context switches = 0 (48 -> 48)
  Num page reclaims = 0 (1677 -> 1677)
  Num page faults = 0 (0 -> 0)
  Num mlx4 interrupts = 0 (44577 -> 44577)

Changes to statistics for Infiniband multi-threaded message transfers:
  Num voluntary context switches = 84 (48 -> 132)
  Num page reclaims = 0 (1677 -> 1677)
  Num page faults = 0 (0 -> 0)
  Num mlx4 interrupts = 0 (44577 -> 44577)


Test duration (secs)  Data length (bytes)  Total messages received  Total data bytes received  Messages per sec  Data bytes per sec  Rx thread free delay (us)  Tx thread max get send buffer (us)  
            1.000012                    0                  1790437                          0           1790416                   0                         10                                 422  
            1.000014                   16                    93994                    1503904             93993             1503883                      10000                                9999  
            1.000013                    0                  1776842                          0           1776819                   0  
            1.000014                    1                  1531084                    1531084           1531062             1531062  
            1.000016                    2                  1531956                    3063912           1531932             3063864  
            1.000016                    4                  1531573                    6126292           1531549             6126196  
            1.000017                    8                  1529457                   12235656           1529431            12235449  
            1.000015                   16                  1530050                   24480800           1530027            24480427  
            1.000016                   32                  1521452                   48686464           1521428            48685692  
            1.000015                   64                  1501436                   96091904           1501413            96090435  
            1.000015                  128                  1476728                  189021184           1476705           189018264  
            1.000019                  256                  1449330                  371028480           1449303           371021542  
            1.000019                  512                  1291901                  661453312           1291876           661440544  
            1.000023                 1024                  1027851                 1052519424           1027827          1052494785  
            1.000036                 2048                   751229                 1538516992            751202          1538461806  
            1.000060                 4096                   491187                 2011901952            491158          2011782092  
            1.000101                 8192                   310657                 2544902144            310626          2544644318  
            1.000208                16384                   150040                 2458255360            150009          2457743896  
            1.000435                32768                    73652                 2413428736             73620          2412378227  
            1.000828                65536                    38603                 2529886208             38571          2527792213  
            1.001638               131072                    19978                 2618556416             19945          2614273919  
            1.003148               262144                    10267                 2691432448             10235          2682985190  
            1.006223               524288                     5211                 2732064768              5179          2715168243  
            1.012453              1048576                     2642                 2770337792              2610          2736263159  
            1.024920              2097152                     1341                 2812280832              1308          2743902467  
            1.050037              4194304                      688                 2885681152               655          2748171764  
            1.097921              8388608                      360                 3019898880               328          2750560189  
            1.199955             16777216                      197                 3305111552               164          2754363948  

Testing using sender using RDMA write with immediate and the receiver polling the CQ
sender_qp capabilities: max_send_wr=95 max_recv_wr=32 max_send_sge=2 max_recv_sge=1 max_inline_data=28
receiver_qp capabilities: max_send_wr=95 max_recv_wr=32 max_send_sge=2 max_recv_sge=1 max_inline_data=28
Changes to statistics for initialisation of Infiniband communications:
  Num voluntary context switches = 40 (159 -> 199)
  Num page reclaims = 1550 (1677 -> 3227)
  Num page faults = 0 (0 -> 0)
  Num mlx4 interrupts = 40 (44599 -> 44639)

Changes to statistics for Infiniband single thread message transfers:
  Num voluntary context switches = 0 (199 -> 199)
  Num page reclaims = 0 (3228 -> 3228)
  Num page faults = 0 (0 -> 0)
  Num mlx4 interrupts = 0 (44639 -> 44639)

Changes to statistics for Infiniband multi-threaded message transfers:
  Num voluntary context switches = 84 (199 -> 283)
  Num page reclaims = 0 (3228 -> 3228)
  Num page faults = 0 (0 -> 0)
  Num mlx4 interrupts = 0 (44639 -> 44639)


Test duration (secs)  Data length (bytes)  Total messages received  Total data bytes received  Messages per sec  Data bytes per sec  Rx thread free delay (us)  Tx thread max get send buffer (us)  
            1.000016                    0                   964186                          0            964171                   0                         10                                 436  
            1.006626                   16                    90033                    1440528             89440             1431046                      10000                               10002  
            1.000024                    0                  1016408                          0           1016383                   0  
            1.000007                    1                  1024763                    1024763           1024756             1024756  
            1.000015                    2                  1020137                    2040274           1020122             2040243  
            1.000011                    4                  1025953                    4103812           1025942             4103769  
            1.000016                    8                  1016534                    8132272           1016518             8132145  
            1.000035                   16                   927999                   14847984            927966            14847457  
            1.000020                   32                   976862                   31259584            976842            31258955  
            1.000035                   64                   983908                   62970112            983873            62967887  
            1.000027                  128                   948219                  121372032            948193           121368713  
            1.000034                  256                   915948                  234482688            915917           234474665  
            1.000039                  512                   853406                  436943872            853373           436927045  
            1.000044                 1024                   712014                  729102336            711982           729070016  
            1.000040                 2048                   562012                 1151000576            561989          1150954203  
            1.000071                 4096                   439361                 1799622656            439330          1799494498  
            1.000118                 8192                   277175                 2270617600            277142          2270349867  
            1.000218                16384                   144606                 2369224704            144575          2368708965  
            1.000422                32768                    75628                 2478178304             75596          2477133150  
            1.000833                65536                    39127                 2564227072             39094          2562093407  
            1.001603               131072                    20131                 2638610432             20099          2634387099  
            1.003131               262144                    10305                 2701393920             10273          2692963592  
            1.006372               524288                     5232                 2743074816              5199          2725706776  
            1.012626              1048576                     2648                 2776629248              2615          2742008032  
            1.024995              2097152                     1344                 2818572288              1311          2749840321  
            1.049639              4194304                      689                 2889875456               656          2753209349  
            1.099131              8388608                      361                 3028287488               328          2755164990  
            1.198779             16777216                      197                 3305111552               164          2757063981  

This shows that opensm is stopped running the number of mlx4 interrupts during the message transfer tests changes
from a few tens to zero. i.e. the message transfer tests are not causing any mlx4 interrupts themselves.
