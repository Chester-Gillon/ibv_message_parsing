Results when not set CPU frequency and opensm running
=====================================================

$ ibv_functional_loopback_test/Release/ibv_functional_loopback_test 
Attributes of device mlx4_0:
 num_comp_vectors=8 fw_ver=2.9.1000
 node_guid=0x8c504b0003c90200 sys_image_guid=0x8f504b0003c90200
 max_mr_size=18446744073709551615 page_size_cap=4294966784 vendor_id=0x2c9 vendor_part_id=0x673c hw_ver=176
 max_qp=131000 max_qp_wr=16351 max_sge=32 max_sge_rd=30
device_cap_flags=IBV_DEVICE_BAD_PKEY_CNTR|IBV_DEVICE_BAD_QKEY_CNTR|IBV_DEVICE_AUTO_PATH_MIG|IBV_DEVICE_CHANGE_PHY_PORT|IBV_DEVICE_UD_AV_PORT_ENFORCE|IBV_DEVICE_PORT_ACTIVE_EVENT|IBV_DEVICE_SYS_IMAGE_GUID|IBV_DEVICE_RC_RNR_NAK_GEN|BIT15|IBV_DEVICE_IP_CSUM|BIT19|IBV_DEVICE_XRC|BIT21|BIT22|BIT26
 max_cq=65408 max_cqe=4194303 max_mr=524272 max_pd=32764
 max_qp_rd_atom=16 max_ee_rd_atom=0 max_res_rd_atom=2096000 max_qp_init_rd_atom=128
 max_ee_init_rd_atom=0 atomic_cap=IBV_ATOMIC_HCA
 max_ee=0 max_rdd=0 max_mw=0 max_raw_ipv6_qp=0 max_raw_ethy_qp=0
 max_mcast_grp=8192 max_mcast_qp_attach=248 max_total_mcast_qp_attach=2031616
 max_ah=0 max_fmr=0 max_map_per_fmr=8191 max_srq=65472 max_srq_wr=16383
 max_srq_sge=31 max_pkeys=128 local_ca_ack_delay=15 phys_port_cnt=2
Attributes of source port 1:
 state=IBV_PORT_ACTIVE max_mtu=IBV_MTU_4096 active_mtu=IBV_MTU_4096
 gid_tbl_len=128 port_cap_flags=0x251086a max_msg_sz=1073741824
 bad_pkey_cntr=0 qkey_viol_cntr=0 pkey_tbl_len=128 lid=1 sm_lid=1
 lmc=0 max_vl_num=3 sm_sl=0 subnet_timeout=18 init_type_reply=0
 active_width=2 active_speed=4 phys_state=5 link_layer=IBV_LINK_LAYER_INFINIBAND
Attributes of destination port 2:
 state=IBV_PORT_ACTIVE max_mtu=IBV_MTU_4096 active_mtu=IBV_MTU_4096
 gid_tbl_len=128 port_cap_flags=0x2510868 max_msg_sz=1073741824
 bad_pkey_cntr=0 qkey_viol_cntr=0 pkey_tbl_len=128 lid=2 sm_lid=1
 lmc=0 max_vl_num=3 sm_sl=0 subnet_timeout=18 init_type_reply=0
 active_width=2 active_speed=4 phys_state=5 link_layer=IBV_LINK_LAYER_INFINIBAND

Testing using sender using RDMA write and the receiver passive
message_send_qp capabilities: max_send_wr=223 max_recv_wr=1 max_send_sge=2 max_recv_sge=1 max_inline_data=28
freed_sequence_number_qp capabilities: max_send_wr=95 max_recv_wr=1 max_send_sge=2 max_recv_sge=1 max_inline_data=28
Changes to statistics for initialisation of Infiniband communications:
  Num voluntary context switches = 38 (10 -> 48)
  Num page reclaims = 1555 (126 -> 1681)
  Num page faults = 0 (0 -> 0)
  Num mlx4 interrupts = 38 (7005 -> 7043)

Changes to statistics for Infiniband single thread message transfers:
  Num voluntary context switches = 0 (48 -> 48)
  Num page reclaims = 0 (1682 -> 1682)
  Num page faults = 0 (0 -> 0)
  Num mlx4 interrupts = 0 (7043 -> 7043)

Changes to statistics for Infiniband multi-threaded message transfers:
  Num voluntary context switches = 84 (48 -> 132)
  Num page reclaims = 0 (1682 -> 1682)
  Num page faults = 0 (0 -> 0)
  Num mlx4 interrupts = 36 (7043 -> 7079)


Test duration (secs)  Data length (bytes)  Total messages received  Total data bytes received  Messages per sec  Data bytes per sec  Rx thread free delay (us)  Tx thread max get send buffer (us)  
            1.000004                    0                  2214376                          0           2214367                   0                         10                                  14  
            1.004956                   16                    95033                    1520528             94564             1513030                      10000                                9996  
            1.000005                    0                  2215295                          0           2215283                   0  
            1.000007                    1                  2048737                    2048737           2048723             2048723  
            1.000007                    2                  2047286                    4094572           2047271             4094542  
            1.000005                    4                  2049261                    8197044           2049251             8197005  
            1.000005                    8                  2049141                   16393128           2049131            16393046  
            1.000007                   16                  2048063                   32769008           2048049            32768784  
            1.000008                   32                  1871611                   59891552           1871597            59891089  
            1.000008                   64                  1860938                  119100032           1860924           119099123  
            1.000006                  128                  1781878                  228080384           1781866           228078906  
            1.000009                  256                  1668780                  427207680           1668766           427203991  
            1.000016                  512                  1494120                  764989440           1494096           764977027  
            1.000028                 1024                  1233091                 1262685184           1233057          1262650108  
            1.000028                 2048                   877968                 1798078464            877943          1798027425  
            1.000056                 4096                   547265                 2241597440            547234          2241472234  
            1.000101                 8192                   318803                 2611634176            318771          2611369694  
            1.000208                16384                   155086                 2540929024            155054          2540400313  
            1.000417                32768                    77672                 2545156096             77640          2544095244  
            1.000816                65536                    39860                 2612264960             39827          2610134412  
            1.001599               131072                    20311                 2662203392             20279          2657953789  
            1.003156               262144                    10383                 2721841152             10350          2713278184  
            1.006230               524288                     5262                 2758803456              5229          2741723239  
            1.012268              1048576                     2660                 2789212160              2628          2755408666  
            1.024931              2097152                     1350                 2831155200              1317          2762287837  
            1.049808              4194304                      692                 2902458368               659          2764752433  
            1.097221              8388608                      362                 3036676096               330          2767605604  
            1.199744             16777216                      198                 3321888768               165          2768830191  

Testing using sender using RDMA write with immediate and the receiver polling the CQ
sender_qp capabilities: max_send_wr=95 max_recv_wr=32 max_send_sge=2 max_recv_sge=1 max_inline_data=28
receiver_qp capabilities: max_send_wr=95 max_recv_wr=32 max_send_sge=2 max_recv_sge=1 max_inline_data=28
Changes to statistics for initialisation of Infiniband communications:
  Num voluntary context switches = 40 (159 -> 199)
  Num page reclaims = 1550 (1682 -> 3232)
  Num page faults = 0 (0 -> 0)
  Num mlx4 interrupts = 40 (7101 -> 7141)

Changes to statistics for Infiniband single thread message transfers:
  Num voluntary context switches = 0 (199 -> 199)
  Num page reclaims = 0 (3232 -> 3232)
  Num page faults = 0 (0 -> 0)
  Num mlx4 interrupts = 0 (7141 -> 7141)

Changes to statistics for Infiniband multi-threaded message transfers:
  Num voluntary context switches = 84 (199 -> 283)
  Num page reclaims = 0 (3232 -> 3232)
  Num page faults = 0 (0 -> 0)
  Num mlx4 interrupts = 35 (7141 -> 7176)


Test duration (secs)  Data length (bytes)  Total messages received  Total data bytes received  Messages per sec  Data bytes per sec  Rx thread free delay (us)  Tx thread max get send buffer (us)  
            1.000013                    0                   974418                          0            974406                   0                         10                                  39  
            1.006253                   16                    90033                    1440528             89474             1431576                      10000                               10003  
            1.000030                    0                  1003928                          0           1003898                   0  
            1.000014                    1                  1021833                    1021833           1021818             1021818  
            1.000014                    2                  1020060                    2040120           1020046             2040092  
            1.000022                    4                  1016877                    4067508           1016855             4067419  
            1.000029                    8                  1019468                    8155744           1019438             8155507  
            1.000032                   16                   993281                   15892496            993249            15891988  
            1.000026                   32                   958831                   30682592            958806            30681804  
            1.000023                   64                   925449                   59228736            925428            59227370  
            1.000036                  128                   941317                  120488576            941284           120484290  
            1.000021                  256                   902750                  231104000            902731           231099182  
            1.000018                  512                   849066                  434721792            849051           434714011  
            1.000039                 1024                   734680                  752312320            734652           752283309  
            1.000046                 2048                   607831                 1244837888            607803          1244780296  
            1.000068                 4096                   437373                 1791479808            437343          1791358578  
            1.000122                 8192                   276086                 2261696512            276052          2261420406  
            1.000223                16384                   144012                 2359492608            143980          2358965924  
            1.000429                32768                    75373                 2469822464             75341          2468763160  
            1.000836                65536                    39054                 2559442944             39021          2557305844  
            1.001621               131072                    20171                 2643853312             20138          2639574717  
            1.003148               262144                    10314                 2703753216             10282          2695267345  
            1.006319               524288                     5233                 2743599104              5200          2726371769  
            1.012352              1048576                     2647                 2775580672              2615          2741714494  
            1.024456              2097152                     1343                 2816475136              1311          2749240821  
            1.050052              4194304                      689                 2889875456               656          2752126714  
            1.099836              8388608                      361                 3028287488               328          2753399408  
            1.200548             16777216                      197                 3305111552               164          2753002922  



Results when not set CPU frequency and opensm stopped
=====================================================

$ sudo kill -STOP `pgrep opensm`
[sudo] password for mr_halfword: 

[1]+  Stopped                 sudo opensm
mr_halfword@Sandy-Ubuntu:~/ibv_message_passing$ ibv_functional_loopback_test/Release/ibv_functional_loopback_test 
Attributes of device mlx4_0:
 num_comp_vectors=8 fw_ver=2.9.1000
 node_guid=0x8c504b0003c90200 sys_image_guid=0x8f504b0003c90200
 max_mr_size=18446744073709551615 page_size_cap=4294966784 vendor_id=0x2c9 vendor_part_id=0x673c hw_ver=176
 max_qp=131000 max_qp_wr=16351 max_sge=32 max_sge_rd=30
device_cap_flags=IBV_DEVICE_BAD_PKEY_CNTR|IBV_DEVICE_BAD_QKEY_CNTR|IBV_DEVICE_AUTO_PATH_MIG|IBV_DEVICE_CHANGE_PHY_PORT|IBV_DEVICE_UD_AV_PORT_ENFORCE|IBV_DEVICE_PORT_ACTIVE_EVENT|IBV_DEVICE_SYS_IMAGE_GUID|IBV_DEVICE_RC_RNR_NAK_GEN|BIT15|IBV_DEVICE_IP_CSUM|BIT19|IBV_DEVICE_XRC|BIT21|BIT22|BIT26
 max_cq=65408 max_cqe=4194303 max_mr=524272 max_pd=32764
 max_qp_rd_atom=16 max_ee_rd_atom=0 max_res_rd_atom=2096000 max_qp_init_rd_atom=128
 max_ee_init_rd_atom=0 atomic_cap=IBV_ATOMIC_HCA
 max_ee=0 max_rdd=0 max_mw=0 max_raw_ipv6_qp=0 max_raw_ethy_qp=0
 max_mcast_grp=8192 max_mcast_qp_attach=248 max_total_mcast_qp_attach=2031616
 max_ah=0 max_fmr=0 max_map_per_fmr=8191 max_srq=65472 max_srq_wr=16383
 max_srq_sge=31 max_pkeys=128 local_ca_ack_delay=15 phys_port_cnt=2
Attributes of source port 1:
 state=IBV_PORT_ACTIVE max_mtu=IBV_MTU_4096 active_mtu=IBV_MTU_4096
 gid_tbl_len=128 port_cap_flags=0x251086a max_msg_sz=1073741824
 bad_pkey_cntr=0 qkey_viol_cntr=0 pkey_tbl_len=128 lid=1 sm_lid=1
 lmc=0 max_vl_num=3 sm_sl=0 subnet_timeout=18 init_type_reply=0
 active_width=2 active_speed=4 phys_state=5 link_layer=IBV_LINK_LAYER_INFINIBAND
Attributes of destination port 2:
 state=IBV_PORT_ACTIVE max_mtu=IBV_MTU_4096 active_mtu=IBV_MTU_4096
 gid_tbl_len=128 port_cap_flags=0x2510868 max_msg_sz=1073741824
 bad_pkey_cntr=0 qkey_viol_cntr=0 pkey_tbl_len=128 lid=2 sm_lid=1
 lmc=0 max_vl_num=3 sm_sl=0 subnet_timeout=18 init_type_reply=0
 active_width=2 active_speed=4 phys_state=5 link_layer=IBV_LINK_LAYER_INFINIBAND

Testing using sender using RDMA write and the receiver passive
message_send_qp capabilities: max_send_wr=223 max_recv_wr=1 max_send_sge=2 max_recv_sge=1 max_inline_data=28
freed_sequence_number_qp capabilities: max_send_wr=95 max_recv_wr=1 max_send_sge=2 max_recv_sge=1 max_inline_data=28
Changes to statistics for initialisation of Infiniband communications:
  Num voluntary context switches = 38 (10 -> 48)
  Num page reclaims = 1555 (122 -> 1677)
  Num page faults = 0 (0 -> 0)
  Num mlx4 interrupts = 38 (7306 -> 7344)

Changes to statistics for Infiniband single thread message transfers:
  Num voluntary context switches = 0 (48 -> 48)
  Num page reclaims = 0 (1678 -> 1678)
  Num page faults = 0 (0 -> 0)
  Num mlx4 interrupts = 0 (7344 -> 7344)

Changes to statistics for Infiniband multi-threaded message transfers:
  Num voluntary context switches = 84 (48 -> 132)
  Num page reclaims = 0 (1678 -> 1678)
  Num page faults = 0 (0 -> 0)
  Num mlx4 interrupts = 0 (7344 -> 7344)


Test duration (secs)  Data length (bytes)  Total messages received  Total data bytes received  Messages per sec  Data bytes per sec  Rx thread free delay (us)  Tx thread max get send buffer (us)  
            0.999997                    0                  2217643                          0           2217650                   0                         10                                  13  
            1.005021                   16                    95033                    1520528             94558             1512932                      10000                                9996  
            1.000006                    0                  2219283                          0           2219270                   0  
            1.000007                    1                  2050122                    2050122           2050109             2050109  
            1.000006                    2                  2049559                    4099118           2049547             4099094  
            1.000006                    4                  2049987                    8199948           2049974             8199897  
            1.000006                    8                  2049347                   16394776           2049334            16394672  
            1.000006                   16                  2048776                   32780416           2048763            32780205  
            1.000008                   32                  1867328                   59754496           1867313            59754003  
            1.000008                   64                  1856117                  118791488           1856102           118790509  
            1.000009                  128                  1782215                  228123520           1782199           228121430  
            1.000010                  256                  1674549                  428684544           1674532           428680109  
            1.000013                  512                  1495366                  765627392           1495347           765617654  
            1.000027                 1024                  1217343                 1246559232           1217311          1246526092  
            1.000037                 2048                   872339                 1786550272            872307          1786483981  
            1.000060                 4096                   545302                 2233556992            545269          2233423342  
            1.000103                 8192                   316565                 2593300480            316532          2593033003  
            1.000207                16384                   156021                 2556248064            155989          2555717862  
            1.000424                32768                    77387                 2535817216             77354          2534742706  
            1.000822                65536                    39860                 2612264960             39827          2610119077  
            1.001597               131072                    20330                 2664693760             20298          2660446299  
            1.003152               262144                    10392                 2724200448             10359          2715640499  
            1.006228               524288                     5263                 2759327744              5230          2742247690  
            1.012346              1048576                     2662                 2791309312              2630          2757269276  
            1.024465              2097152                     1350                 2831155200              1318          2763546106  
            1.049175              4194304                      692                 2902458368               660          2766420231  
            1.099557              8388608                      363                 3045064704               330          2769356091  
            1.199293             16777216                      198                 3321888768               165          2769872880  

Testing using sender using RDMA write with immediate and the receiver polling the CQ
sender_qp capabilities: max_send_wr=95 max_recv_wr=32 max_send_sge=2 max_recv_sge=1 max_inline_data=28
receiver_qp capabilities: max_send_wr=95 max_recv_wr=32 max_send_sge=2 max_recv_sge=1 max_inline_data=28
Changes to statistics for initialisation of Infiniband communications:
  Num voluntary context switches = 40 (160 -> 200)
  Num page reclaims = 1550 (1679 -> 3229)
  Num page faults = 0 (0 -> 0)
  Num mlx4 interrupts = 40 (7366 -> 7406)

Changes to statistics for Infiniband single thread message transfers:
  Num voluntary context switches = 0 (200 -> 200)
  Num page reclaims = 0 (3229 -> 3229)
  Num page faults = 0 (0 -> 0)
  Num mlx4 interrupts = 0 (7406 -> 7406)

Changes to statistics for Infiniband multi-threaded message transfers:
  Num voluntary context switches = 84 (200 -> 284)
  Num page reclaims = 0 (3229 -> 3229)
  Num page faults = 0 (0 -> 0)
  Num mlx4 interrupts = 0 (7406 -> 7406)


Test duration (secs)  Data length (bytes)  Total messages received  Total data bytes received  Messages per sec  Data bytes per sec  Rx thread free delay (us)  Tx thread max get send buffer (us)  
            1.000026                    0                   967896                          0            967871                   0                         10                                 572  
            1.007902                   16                    90033                    1440528             89327             1429234                      10000                               10004  
            1.000012                    0                  1005085                          0           1005073                   0  
            1.000025                    1                  1019487                    1019487           1019461             1019461  
            1.000002                    2                  1017521                    2035042           1017519             2035038  
            1.000017                    4                  1012552                    4050208           1012534             4050138  
            1.000011                    8                  1023621                    8188968           1023610             8188878  
            1.000022                   16                  1018886                   16302176           1018863            16301816  
            1.000028                   32                   976961                   31262752            976934            31261884  
            1.000025                   64                   939492                   60127488            939469            60125992  
            1.000034                  128                   949241                  121502848            949209           121498761  
            1.000021                  256                   915454                  234356224            915435           234351391  
            1.000039                  512                   874875                  447936000            874841           447918735  
            1.000047                 1024                   675072                  691273728            675040           691240984  
            1.000048                 2048                   634271                 1298987008            634240          1298924227  
            1.000072                 4096                   439792                 1801388032            439760          1801258471  
            1.000118                 8192                   275180                 2254274560            275147          2254008060  
            1.000224                16384                   143986                 2359066624            143954          2358538352  
            1.000427                32768                    75358                 2469330944             75326          2468276247  
            1.000827                65536                    39019                 2557149184             38987          2555037058  
            1.001616               131072                    20163                 2642804736             20130          2638539950  
            1.003156               262144                    10315                 2704015360             10283          2695507102  
            1.006279               524288                     5233                 2743599104              5200          2726479897  
            1.012552              1048576                     2648                 2776629248              2615          2742210159  
            1.025110              2097152                     1344                 2818572288              1311          2749530561  
            1.050029              4194304                      689                 2889875456               656          2752187189  
            1.100212              8388608                      361                 3028287488               328          2752458059  
            1.200029             16777216                      197                 3305111552               164          2754192975  

This shows that opensm is stopped running the number of mlx4 interrupts during the message transfer tests changes
from a few tens to zero. i.e. the message transfer tests are not causing any mlx4 interrupts themselves.
