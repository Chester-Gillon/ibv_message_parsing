For these tests opensm was stopped after the Infiniband ports got to the PORT_ACTIVE, by using:
$ sudo kill -STOP `pgrep opensm`

Stopping opensm prevents ml4x a few interrupts from occuring per second, and results in no mlx4 interrupts
occurring during the message transfer tests.
As a result the only ml4x interrupts occur during initialisation.


Results when intel_pstate driver running, and the reported CPU frequencies are changing
=======================================================================================  

$ ibv_functional_loopback_test/Release/ibv_functional_loopback_test 
Attributes of device mlx4_0:
 num_comp_vectors=8 fw_ver=2.9.1000
 node_guid=0x8c504b0003c90200 sys_image_guid=0x8f504b0003c90200
 max_mr_size=18446744073709551615 page_size_cap=4294966784 vendor_id=0x2c9 vendor_part_id=0x673c hw_ver=176
 max_qp=131000 max_qp_wr=16351 max_sge=32 max_sge_rd=30
device_cap_flags=IBV_DEVICE_BAD_PKEY_CNTR|IBV_DEVICE_BAD_QKEY_CNTR|IBV_DEVICE_AUTO_PATH_MIG|IBV_DEVICE_CHANGE_PHY_PORT|IBV_DEVICE_UD_AV_PORT_ENFORCE|IBV_DEVICE_PORT_ACTIVE_EVENT|IBV_DEVICE_SYS_IMAGE_GUID|IBV_DEVICE_RC_RNR_NAK_GEN|BIT15|IBV_DEVICE_IP_CSUM|BIT19|IBV_DEVICE_XRC|BIT21|BIT22|BIT26
 max_cq=65408 max_cqe=4194303 max_mr=524272 max_pd=32764
 max_qp_rd_atom=16 max_ee_rd_atom=0 max_res_rd_atom=2096000 max_qp_init_rd_atom=128
 max_ee_init_rd_atom=0 atomic_cap=IBV_ATOMIC_HCA
 max_ee=0 max_rdd=0 max_mw=0 max_raw_ipv6_qp=0 max_raw_ethy_qp=0
 max_mcast_grp=8192 max_mcast_qp_attach=248 max_total_mcast_qp_attach=2031616
 max_ah=0 max_fmr=0 max_map_per_fmr=8191 max_srq=65472 max_srq_wr=16383
 max_srq_sge=31 max_pkeys=128 local_ca_ack_delay=15 phys_port_cnt=2
Attributes of source port 1:
 state=IBV_PORT_ACTIVE max_mtu=IBV_MTU_4096 active_mtu=IBV_MTU_4096
 gid_tbl_len=128 port_cap_flags=0x251086a max_msg_sz=1073741824
 bad_pkey_cntr=0 qkey_viol_cntr=0 pkey_tbl_len=128 lid=1 sm_lid=1
 lmc=0 max_vl_num=3 sm_sl=0 subnet_timeout=18 init_type_reply=0
 active_width=2 active_speed=4 phys_state=5 link_layer=IBV_LINK_LAYER_INFINIBAND
Attributes of destination port 2:
 state=IBV_PORT_ACTIVE max_mtu=IBV_MTU_4096 active_mtu=IBV_MTU_4096
 gid_tbl_len=128 port_cap_flags=0x2510868 max_msg_sz=1073741824
 bad_pkey_cntr=0 qkey_viol_cntr=0 pkey_tbl_len=128 lid=2 sm_lid=1
 lmc=0 max_vl_num=3 sm_sl=0 subnet_timeout=18 init_type_reply=0
 active_width=2 active_speed=4 phys_state=5 link_layer=IBV_LINK_LAYER_INFINIBAND

Testing using sender using RDMA write and the receiver passive
message_send_qp capabilities: max_send_wr=223 max_recv_wr=1 max_send_sge=2 max_recv_sge=1 max_inline_data=28
freed_sequence_number_qp capabilities: max_send_wr=95 max_recv_wr=1 max_send_sge=2 max_recv_sge=1 max_inline_data=28
Current CPU frequencies (MHz) :  3099714  3098242  3099941  3194417
Changes to statistics for initialisation of Infiniband communications:
  Num voluntary context switches = 38 (12 -> 50)
  Num page reclaims = 1554 (142 -> 1696)
  Num page faults = 0 (0 -> 0)
  Num mlx4 interrupts = 38 (13255 -> 13293)
  Port 1 Tx Bytes = 72 (162590875597 -> 162590875669)
  Port 1 Rx Bytes = 72 (5009185281 -> 5009185353)
  Port 1 Tx Packets = 1 (692514664 -> 692514665)
  Port 1 Rx Packets = 1 (598727282 -> 598727283)
  Port 1 Tx Unicast Packets = 0 (0 -> 0)
  Port 1 Rx Unicast Packets = 0 (0 -> 0)
  Port 1 Tx Multicast Packets = 0 (0 -> 0)
  Port 1 Rx Multicast Packets = 0 (0 -> 0)
  Port 2 Tx Bytes = 72 (5009185281 -> 5009185353)
  Port 2 Rx Bytes = 72 (162590875669 -> 162590875741)
  Port 2 Tx Packets = 1 (598727282 -> 598727283)
  Port 2 Rx Packets = 1 (692514665 -> 692514666)
  Port 2 Tx Unicast Packets = 0 (0 -> 0)
  Port 2 Rx Unicast Packets = 0 (0 -> 0)
  Port 2 Tx Multicast Packets = 0 (0 -> 0)
  Port 2 Rx Multicast Packets = 0 (0 -> 0)

Changes to statistics for Infiniband single thread message transfers:
  Num voluntary context switches = 0 (54 -> 54)
  Num page reclaims = 0 (1697 -> 1697)
  Num page faults = 0 (0 -> 0)
  Num mlx4 interrupts = 0 (13307 -> 13307)
  Port 1 Tx Bytes = 816338100 (162590875741 -> 163407213841)
  Port 1 Rx Bytes = 28598 (5009185425 -> 5009214023)
  Port 1 Tx Packets = 793330 (692514666 -> 693307996)
  Port 1 Rx Packets = 3855 (598727284 -> 598731139)
  Port 1 Tx Unicast Packets = 0 (0 -> 0)
  Port 1 Rx Unicast Packets = 0 (0 -> 0)
  Port 1 Tx Multicast Packets = 0 (0 -> 0)
  Port 1 Rx Multicast Packets = 0 (0 -> 0)
  Port 2 Tx Bytes = 28598 (5009185425 -> 5009214023)
  Port 2 Rx Bytes = 816338100 (162590875813 -> 163407213913)
  Port 2 Tx Packets = 3855 (598727284 -> 598731139)
  Port 2 Rx Packets = 793330 (692514667 -> 693307997)
  Port 2 Tx Unicast Packets = 0 (0 -> 0)
  Port 2 Rx Unicast Packets = 0 (0 -> 0)
  Port 2 Tx Multicast Packets = 0 (0 -> 0)
  Port 2 Rx Multicast Packets = 0 (0 -> 0)

Changes to statistics for Infiniband multi-threaded message transfers:
  Num voluntary context switches = 84 (58 -> 142)
  Num page reclaims = 0 (1697 -> 1697)
  Num page faults = 0 (0 -> 0)
  Num mlx4 interrupts = 0 (13319 -> 13319)
  Port 1 Tx Bytes = 10934290012 (163407213913 -> 174341503925)
  Port 1 Rx Bytes = 578003872 (5009214095 -> 5587217967)
  Port 1 Tx Packets = 77158774 (693307997 -> 770466771)
  Port 1 Rx Packets = 67292945 (598731140 -> 666024085)
  Port 1 Tx Unicast Packets = 0 (0 -> 0)
  Port 1 Rx Unicast Packets = 0 (0 -> 0)
  Port 1 Tx Multicast Packets = 0 (0 -> 0)
  Port 1 Rx Multicast Packets = 0 (0 -> 0)
  Port 2 Tx Bytes = 578003872 (5009214095 -> 5587217967)
  Port 2 Rx Bytes = 10934290012 (163407213985 -> 174341503997)
  Port 2 Tx Packets = 67292945 (598731140 -> 666024085)
  Port 2 Rx Packets = 77158774 (693307998 -> 770466772)
  Port 2 Tx Unicast Packets = 0 (0 -> 0)
  Port 2 Rx Unicast Packets = 0 (0 -> 0)
  Port 2 Tx Multicast Packets = 0 (0 -> 0)
  Port 2 Rx Multicast Packets = 0 (0 -> 0)


Test duration (secs)  Data length (bytes)  Total messages received  Total data bytes received  Messages per sec  Data bytes per sec  Rx thread free delay (us)  Tx thread max get send buffer (us)  
            1.000008                    0                  2221521                          0           2221504                   0                         10                                  26  
            1.005049                   16                    95033                    1520528             94556             1512890                      10000                                9996  
            1.000007                    0                  2221842                          0           2221826                   0  
            1.000005                    1                  2048901                    2048901           2048890             2048890  
            1.000008                    2                  2048839                    4097678           2048822             4097643  
            1.000005                    4                  2049545                    8198180           2049535             8198141  
            1.000006                    8                  2049942                   16399536           2049929            16399434  
            1.000008                   16                  2049872                   32797952           2049855            32797682  
            1.000008                   32                  1868912                   59805184           1868897            59804712  
            1.000009                   64                  1856428                  118811392           1856411           118810310  
            1.000010                  128                  1777476                  227516928           1777458           227514564  
            1.000013                  256                  1674536                  428681216           1674515           428675802  
            1.000011                  512                  1496079                  765992448           1496062           765983881  
            1.000025                 1024                  1221891                 1251216384           1221860          1251185019  
            1.000032                 2048                   878573                 1799317504            878545          1799259163  
            1.000055                 4096                   544731                 2231218176            544701          2231096548  
            1.000100                 8192                   316154                 2589933568            316122          2589673819  
            1.000204                16384                   156887                 2570436608            156855          2569912593  
            1.000410                32768                    78220                 2563112960             78188          2562062161  
            1.000790                65536                    40895                 2680094720             40863          2677980181  
            1.001594               131072                    20872                 2735734784             20839          2731381255  
            1.003057               262144                    10545                 2764308480             10513          2755884716  
            1.006230               524288                     5312                 2785017856              5279          2767775324  
            1.012356              1048576                     2678                 2808086528              2645          2773812464  
            1.024738              2097152                     1357                 2845835264              1324          2777135305  
            1.049089              4194304                      695                 2915041280               662          2778639972  
            1.099030              8388608                      364                 3053453312               331          2778315813  
            1.195578             16777216                      198                 3321888768               166          2778479120  

Testing using sender using RDMA write with immediate and the receiver polling the CQ
sender_qp capabilities: max_send_wr=95 max_recv_wr=32 max_send_sge=2 max_recv_sge=1 max_inline_data=28
receiver_qp capabilities: max_send_wr=95 max_recv_wr=32 max_send_sge=2 max_recv_sge=1 max_inline_data=28
Current CPU frequencies (MHz) :  3194304  3099941  3099941  3095976
Changes to statistics for initialisation of Infiniband communications:
  Num voluntary context switches = 40 (173 -> 213)
  Num page reclaims = 1550 (1699 -> 3249)
  Num page faults = 0 (0 -> 0)
  Num mlx4 interrupts = 40 (13353 -> 13393)
  Port 1 Tx Bytes = 72 (174341504018 -> 174341504090)
  Port 1 Rx Bytes = 72 (5587218057 -> 5587218129)
  Port 1 Tx Packets = 1 (770466774 -> 770466775)
  Port 1 Rx Packets = 1 (666024088 -> 666024089)
  Port 1 Tx Unicast Packets = 0 (0 -> 0)
  Port 1 Rx Unicast Packets = 0 (0 -> 0)
  Port 1 Tx Multicast Packets = 0 (0 -> 0)
  Port 1 Rx Multicast Packets = 0 (0 -> 0)
  Port 2 Tx Bytes = 72 (5587218057 -> 5587218129)
  Port 2 Rx Bytes = 72 (174341504090 -> 174341504162)
  Port 2 Tx Packets = 1 (666024088 -> 666024089)
  Port 2 Rx Packets = 1 (770466775 -> 770466776)
  Port 2 Tx Unicast Packets = 0 (0 -> 0)
  Port 2 Rx Unicast Packets = 0 (0 -> 0)
  Port 2 Tx Multicast Packets = 0 (0 -> 0)
  Port 2 Rx Multicast Packets = 0 (0 -> 0)

Changes to statistics for Infiniband single thread message transfers:
  Num voluntary context switches = 0 (217 -> 217)
  Num page reclaims = 0 (3249 -> 3249)
  Num page faults = 0 (0 -> 0)
  Num mlx4 interrupts = 0 (13405 -> 13405)
  Port 1 Tx Bytes = 816334008 (174341504162 -> 175157838170)
  Port 1 Rx Bytes = 27198 (5587218201 -> 5587245399)
  Port 1 Tx Packets = 792856 (770466776 -> 771259632)
  Port 1 Rx Packets = 3655 (666024090 -> 666027745)
  Port 1 Tx Unicast Packets = 0 (0 -> 0)
  Port 1 Rx Unicast Packets = 0 (0 -> 0)
  Port 1 Tx Multicast Packets = 0 (0 -> 0)
  Port 1 Rx Multicast Packets = 0 (0 -> 0)
  Port 2 Tx Bytes = 27198 (5587218201 -> 5587245399)
  Port 2 Rx Bytes = 816334008 (174341504234 -> 175157838242)
  Port 2 Tx Packets = 3655 (666024090 -> 666027745)
  Port 2 Rx Packets = 792856 (770466777 -> 771259633)
  Port 2 Tx Unicast Packets = 0 (0 -> 0)
  Port 2 Rx Unicast Packets = 0 (0 -> 0)
  Port 2 Tx Multicast Packets = 0 (0 -> 0)
  Port 2 Rx Multicast Packets = 0 (0 -> 0)

Changes to statistics for Infiniband multi-threaded message transfers:
  Num voluntary context switches = 84 (221 -> 305)
  Num page reclaims = 0 (3249 -> 3249)
  Num page faults = 0 (0 -> 0)
  Num mlx4 interrupts = 0 (13418 -> 13418)
  Port 1 Tx Bytes = 9606576840 (175157838242 -> 184764415082)
  Port 1 Rx Bytes = 245571811 (5587245471 -> 5832817282)
  Port 1 Tx Packets = 30157809 (771259633 -> 801417442)
  Port 1 Rx Packets = 26955374 (666027746 -> 692983120)
  Port 1 Tx Unicast Packets = 0 (0 -> 0)
  Port 1 Rx Unicast Packets = 0 (0 -> 0)
  Port 1 Tx Multicast Packets = 0 (0 -> 0)
  Port 1 Rx Multicast Packets = 0 (0 -> 0)
  Port 2 Tx Bytes = 245571811 (5587245471 -> 5832817282)
  Port 2 Rx Bytes = 9606576840 (175157838314 -> 184764415154)
  Port 2 Tx Packets = 26955374 (666027746 -> 692983120)
  Port 2 Rx Packets = 30157809 (771259634 -> 801417443)
  Port 2 Tx Unicast Packets = 0 (0 -> 0)
  Port 2 Rx Unicast Packets = 0 (0 -> 0)
  Port 2 Tx Multicast Packets = 0 (0 -> 0)
  Port 2 Rx Multicast Packets = 0 (0 -> 0)


Test duration (secs)  Data length (bytes)  Total messages received  Total data bytes received  Messages per sec  Data bytes per sec  Rx thread free delay (us)  Tx thread max get send buffer (us)  
            1.000020                    0                   974859                          0            974839                   0                         10                                 663  
            1.007201                   16                    90033                    1440528             89389             1430229                      10000                               10026  
            1.000019                    0                  1029031                          0           1029011                   0  
            1.000017                    1                  1026377                    1026377           1026360             1026360  
            1.000022                    2                  1030870                    2061740           1030848             2061695  
            1.000021                    4                  1028068                    4112272           1028046             4112184  
            1.000005                    8                  1028900                    8231200           1028895             8231156  
            1.000028                   16                  1015193                   16243088           1015165            16242635  
            1.000026                   32                   976822                   31258304            976796            31257485  
            1.000034                   64                   967227                   61902528            967194            61900417  
            1.000021                  128                   946701                  121177728            946681           121175174  
            1.000039                  256                   903533                  231304448            903497           231295319  
            1.000038                  512                   866123                  443454976            866090           443438083  
            1.000026                 1024                   714720                  731873280            714702           731854608  
            1.000034                 2048                   629186                 1288572928            629164          1288528698  
            1.000075                 4096                   438897                 1797722112            438864          1797586513  
            1.000122                 8192                   254555                 2085314560            254524          2085059609  
            1.000228                16384                   144457                 2366783488            144424          2366243826  
            1.000423                32768                    75343                 2468839424             75311          2467796272  
            1.000834                65536                    39124                 2564030464             39091          2561892613  
            1.001599               131072                    20202                 2647916544             20170          2643688123  
            1.003154               262144                    10329                 2707685376             10297          2699171041  
            1.006194               524288                     5238                 2746220544              5206          2729316202  
            1.012395              1048576                     2651                 2779774976              2619          2745740222  
            1.024498              2097152                     1345                 2820669440              1313          2753219841  
            1.049942              4194304                      690                 2894069760               657          2756408750  
            1.098657              8388608                      361                 3028287488               329          2756353356  
            1.198660             16777216                      197                 3305111552               164          2757337956  

Testing using sender using send and the receiver using recv
sender_qp capabilities: max_send_wr=95 max_recv_wr=32 max_send_sge=2 max_recv_sge=1 max_inline_data=28
receiver_qp capabilities: max_send_wr=95 max_recv_wr=32 max_send_sge=2 max_recv_sge=1 max_inline_data=28
Current CPU frequencies (MHz) :  3099714  3197816  3091785  3099488
Changes to statistics for initialisation of Infiniband communications:
  Num voluntary context switches = 40 (339 -> 379)
  Num page reclaims = 1550 (3249 -> 4799)
  Num page faults = 0 (0 -> 0)
  Num mlx4 interrupts = 40 (13454 -> 13494)
  Port 1 Tx Bytes = 72 (184764415176 -> 184764415248)
  Port 1 Rx Bytes = 72 (5832817372 -> 5832817444)
  Port 1 Tx Packets = 1 (801417445 -> 801417446)
  Port 1 Rx Packets = 1 (692983123 -> 692983124)
  Port 1 Tx Unicast Packets = 0 (0 -> 0)
  Port 1 Rx Unicast Packets = 0 (0 -> 0)
  Port 1 Tx Multicast Packets = 0 (0 -> 0)
  Port 1 Rx Multicast Packets = 0 (0 -> 0)
  Port 2 Tx Bytes = 72 (5832817372 -> 5832817444)
  Port 2 Rx Bytes = 72 (184764415248 -> 184764415320)
  Port 2 Tx Packets = 1 (692983123 -> 692983124)
  Port 2 Rx Packets = 1 (801417446 -> 801417447)
  Port 2 Tx Unicast Packets = 0 (0 -> 0)
  Port 2 Rx Unicast Packets = 0 (0 -> 0)
  Port 2 Tx Multicast Packets = 0 (0 -> 0)
  Port 2 Rx Multicast Packets = 0 (0 -> 0)

Changes to statistics for Infiniband single thread message transfers:
  Num voluntary context switches = 0 (383 -> 383)
  Num page reclaims = 0 (4799 -> 4799)
  Num page faults = 0 (0 -> 0)
  Num mlx4 interrupts = 0 (13506 -> 13506)
  Port 1 Tx Bytes = 816332038 (184764415320 -> 185580747358)
  Port 1 Rx Bytes = 25755 (5832817516 -> 5832843271)
  Port 1 Tx Packets = 792851 (801417447 -> 802210298)
  Port 1 Rx Packets = 3670 (692983125 -> 692986795)
  Port 1 Tx Unicast Packets = 0 (0 -> 0)
  Port 1 Rx Unicast Packets = 0 (0 -> 0)
  Port 1 Tx Multicast Packets = 0 (0 -> 0)
  Port 1 Rx Multicast Packets = 0 (0 -> 0)
  Port 2 Tx Bytes = 25755 (5832817516 -> 5832843271)
  Port 2 Rx Bytes = 816332038 (184764415392 -> 185580747430)
  Port 2 Tx Packets = 3670 (692983125 -> 692986795)
  Port 2 Rx Packets = 792851 (801417448 -> 802210299)
  Port 2 Tx Unicast Packets = 0 (0 -> 0)
  Port 2 Rx Unicast Packets = 0 (0 -> 0)
  Port 2 Tx Multicast Packets = 0 (0 -> 0)
  Port 2 Rx Multicast Packets = 0 (0 -> 0)

Changes to statistics for Infiniband multi-threaded message transfers:
  Num voluntary context switches = 84 (387 -> 471)
  Num page reclaims = 0 (4799 -> 4799)
  Num page faults = 0 (0 -> 0)
  Num mlx4 interrupts = 0 (13519 -> 13519)
  Port 1 Tx Bytes = 9565321889 (185580747430 -> 195146069319)
  Port 1 Rx Bytes = 176586195 (5832843343 -> 6009429538)
  Port 1 Tx Packets = 28575283 (802210299 -> 830785582)
  Port 1 Rx Packets = 25226590 (692986796 -> 718213386)
  Port 1 Tx Unicast Packets = 0 (0 -> 0)
  Port 1 Rx Unicast Packets = 0 (0 -> 0)
  Port 1 Tx Multicast Packets = 0 (0 -> 0)
  Port 1 Rx Multicast Packets = 0 (0 -> 0)
  Port 2 Tx Bytes = 176586195 (5832843343 -> 6009429538)
  Port 2 Rx Bytes = 9565321889 (185580747502 -> 195146069391)
  Port 2 Tx Packets = 25226590 (692986796 -> 718213386)
  Port 2 Rx Packets = 28575283 (802210300 -> 830785583)
  Port 2 Tx Unicast Packets = 0 (0 -> 0)
  Port 2 Rx Unicast Packets = 0 (0 -> 0)
  Port 2 Tx Multicast Packets = 0 (0 -> 0)
  Port 2 Rx Multicast Packets = 0 (0 -> 0)


Test duration (secs)  Data length (bytes)  Total messages received  Total data bytes received  Messages per sec  Data bytes per sec  Rx thread free delay (us)  Tx thread max get send buffer (us)  
            1.000043                    0                   847103                          0            847067                   0                         10                                 682  
            1.008193                   16                    90033                    1440528             89301             1428821                      10000                               10002  
            1.000026                    0                   864889                          0            864867                   0  
            1.000001                    1                   883164                     883164            883163              883163  
            1.000029                    2                   878197                    1756394            878172             1756344  
            1.000025                    4                   900006                    3600024            899984             3599935  
            1.000007                    8                   905250                    7242000            905244             7241950  
            1.000033                   16                   980317                   15685072            980285            15684562  
            1.000016                   32                   940094                   30083008            940079            30082531  
            1.000032                   64                   951557                   60899648            951527            60897705  
            1.000017                  128                   946205                  121114240            946189           121112204  
            1.000048                  256                   931063                  238352128            931018           238340676  
            1.000021                  512                   879328                  450215936            879310           450206559  
            1.000060                 1024                   708575                  725580800            708533           725537469  
            1.000061                 2048                   555156                 1136959488            555122          1136890214  
            1.000071                 4096                   434554                 1779933184            434523          1779807206  
            1.000113                 8192                   275355                 2255708160            275324          2255452532  
            1.000217                16384                   145946                 2391179264            145914          2390661093  
            1.000419                32768                    75471                 2473033728             75439          2471999088  
            1.000806                65536                    39828                 2610167808             39796          2608066260  
            1.001594               131072                    20515                 2688942080             20482          2684664065  
            1.003189               262144                    10421                 2731802624             10388          2723118558  
            1.006312               524288                     5264                 2759852032              5231          2742541655  
            1.012249              1048576                     2657                 2786066432              2625          2752352911  
            1.024700              2097152                     1347                 2824863744              1315          2756772064  
            1.048912              4194304                      690                 2894069760               658          2759115947  
            1.100345              8388608                      362                 3036676096               329          2759749068  
            1.197116             16777216                      197                 3305111552               165          2760895118  


Results when CPU frequency set to 2.9 GHz
=========================================

To set the max fixed frequency added intel_pstate=disable to the boot line and ran:
$ sudo cpufreq-set -f 3200000 -c 0
$ sudo cpufreq-set -f 3200000 -c 1
$ sudo cpufreq-set -f 3200000 -c 2
$ sudo cpufreq-set -f 3200000 -c 3

[When the intel_pstate driver was enabled then the reported max CPU frequency was 3.2 GHz, but couldn't set a fixed frequency]

$ ibv_functional_loopback_test/Release/ibv_functional_loopback_test 
Attributes of device mlx4_0:
 num_comp_vectors=8 fw_ver=2.9.1000
 node_guid=0x8c504b0003c90200 sys_image_guid=0x8f504b0003c90200
 max_mr_size=18446744073709551615 page_size_cap=4294966784 vendor_id=0x2c9 vendor_part_id=0x673c hw_ver=176
 max_qp=131000 max_qp_wr=16351 max_sge=32 max_sge_rd=30
device_cap_flags=IBV_DEVICE_BAD_PKEY_CNTR|IBV_DEVICE_BAD_QKEY_CNTR|IBV_DEVICE_AUTO_PATH_MIG|IBV_DEVICE_CHANGE_PHY_PORT|IBV_DEVICE_UD_AV_PORT_ENFORCE|IBV_DEVICE_PORT_ACTIVE_EVENT|IBV_DEVICE_SYS_IMAGE_GUID|IBV_DEVICE_RC_RNR_NAK_GEN|BIT15|IBV_DEVICE_IP_CSUM|BIT19|IBV_DEVICE_XRC|BIT21|BIT22|BIT26
 max_cq=65408 max_cqe=4194303 max_mr=524272 max_pd=32764
 max_qp_rd_atom=16 max_ee_rd_atom=0 max_res_rd_atom=2096000 max_qp_init_rd_atom=128
 max_ee_init_rd_atom=0 atomic_cap=IBV_ATOMIC_HCA
 max_ee=0 max_rdd=0 max_mw=0 max_raw_ipv6_qp=0 max_raw_ethy_qp=0
 max_mcast_grp=8192 max_mcast_qp_attach=248 max_total_mcast_qp_attach=2031616
 max_ah=0 max_fmr=0 max_map_per_fmr=8191 max_srq=65472 max_srq_wr=16383
 max_srq_sge=31 max_pkeys=128 local_ca_ack_delay=15 phys_port_cnt=2
Attributes of source port 1:
 state=IBV_PORT_ACTIVE max_mtu=IBV_MTU_4096 active_mtu=IBV_MTU_4096
 gid_tbl_len=128 port_cap_flags=0x251086a max_msg_sz=1073741824
 bad_pkey_cntr=0 qkey_viol_cntr=0 pkey_tbl_len=128 lid=1 sm_lid=1
 lmc=0 max_vl_num=3 sm_sl=0 subnet_timeout=18 init_type_reply=0
 active_width=2 active_speed=4 phys_state=5 link_layer=IBV_LINK_LAYER_INFINIBAND
Attributes of destination port 2:
 state=IBV_PORT_ACTIVE max_mtu=IBV_MTU_4096 active_mtu=IBV_MTU_4096
 gid_tbl_len=128 port_cap_flags=0x2510868 max_msg_sz=1073741824
 bad_pkey_cntr=0 qkey_viol_cntr=0 pkey_tbl_len=128 lid=2 sm_lid=1
 lmc=0 max_vl_num=3 sm_sl=0 subnet_timeout=18 init_type_reply=0
 active_width=2 active_speed=4 phys_state=5 link_layer=IBV_LINK_LAYER_INFINIBAND

Testing using sender using RDMA write and the receiver passive
message_send_qp capabilities: max_send_wr=223 max_recv_wr=1 max_send_sge=2 max_recv_sge=1 max_inline_data=28
freed_sequence_number_qp capabilities: max_send_wr=95 max_recv_wr=1 max_send_sge=2 max_recv_sge=1 max_inline_data=28
Current CPU frequencies (MHz) :  2901000  2901000  2901000  2901000
Changes to statistics for initialisation of Infiniband communications:
  Num voluntary context switches = 38 (13 -> 51)
  Num page reclaims = 1555 (123 -> 1678)
  Num page faults = 0 (1 -> 1)
  Num mlx4 interrupts = 38 (4431 -> 4469)

Changes to statistics for Infiniband single thread message transfers:
  Num voluntary context switches = 0 (51 -> 51)
  Num page reclaims = 0 (1679 -> 1679)
  Num page faults = 0 (1 -> 1)
  Num mlx4 interrupts = 0 (4469 -> 4469)

Changes to statistics for Infiniband multi-threaded message transfers:
  Num voluntary context switches = 84 (51 -> 135)
  Num page reclaims = 0 (1679 -> 1679)
  Num page faults = 0 (1 -> 1)
  Num mlx4 interrupts = 0 (4469 -> 4469)


Test duration (secs)  Data length (bytes)  Total messages received  Total data bytes received  Messages per sec  Data bytes per sec  Rx thread free delay (us)  Tx thread max get send buffer (us)  
            1.000004                    0                  2217984                          0           2217975                   0                         10                                  14  
            1.005116                   16                    95033                    1520528             94549             1512788                      10000                                9997  
            1.000008                    0                  2217707                          0           2217690                   0  
            1.000005                    1                  2042170                    2042170           2042159             2042159  
            1.000006                    2                  2042916                    4085832           2042904             4085809  
            1.000005                    4                  2042978                    8171912           2042968             8171872  
            1.000008                    8                  2042737                   16341896           2042721            16341768  
            1.000010                   16                  2042685                   32682960           2042664            32682630  
            1.000008                   32                  1861510                   59568320           1861494            59567823  
            1.000009                   64                  1848418                  118298752           1848402           118297717  
            1.000009                  128                  1772326                  226857728           1772310           226855724  
            1.000013                  256                  1671754                  427969024           1671732           427963446  
            1.000018                  512                  1487999                  761855488           1487973           761842103  
            1.000023                 1024                  1234881                 1264518144           1234853          1264489321  
            1.000032                 2048                   877004                 1796104192            876976          1796047417  
            1.000052                 4096                   542770                 2223185920            542742          2223069722  
            1.000098                 8192                   317756                 2603057152            317725          2602802767  
            1.000206                16384                   156159                 2558509056            156127          2557981347  
            1.000420                32768                    77578                 2542075904             77545          2541008734  
            1.000804                65536                    40314                 2642018304             40282          2639894852  
            1.001595               131072                    20694                 2712403968             20661          2708084754  
            1.003148               262144                    10494                 2750939136             10461          2742305525  
            1.006157               524288                     5295                 2776104960              5263          2759118146  
            1.012443              1048576                     2671                 2800746496              2638          2766325826  
            1.024591              2097152                     1354                 2839543808              1322          2771391881  
            1.049840              4194304                      694                 2910846976               661          2772657599  
            1.097801              8388608                      363                 3045064704               331          2773786943  
            1.196625             16777216                      198                 3321888768               165          2776049000  

Testing using sender using RDMA write with immediate and the receiver polling the CQ
sender_qp capabilities: max_send_wr=95 max_recv_wr=32 max_send_sge=2 max_recv_sge=1 max_inline_data=28
receiver_qp capabilities: max_send_wr=95 max_recv_wr=32 max_send_sge=2 max_recv_sge=1 max_inline_data=28
Current CPU frequencies (MHz) :  2901000  2901000  2901000  2901000
Changes to statistics for initialisation of Infiniband communications:
  Num voluntary context switches = 40 (162 -> 202)
  Num page reclaims = 1550 (1681 -> 3231)
  Num page faults = 0 (1 -> 1)
  Num mlx4 interrupts = 40 (4491 -> 4531)

Changes to statistics for Infiniband single thread message transfers:
  Num voluntary context switches = 0 (202 -> 202)
  Num page reclaims = 0 (3231 -> 3231)
  Num page faults = 0 (1 -> 1)
  Num mlx4 interrupts = 0 (4531 -> 4531)

Changes to statistics for Infiniband multi-threaded message transfers:
  Num voluntary context switches = 84 (202 -> 286)
  Num page reclaims = 0 (3231 -> 3231)
  Num page faults = 0 (1 -> 1)
  Num mlx4 interrupts = 0 (4531 -> 4531)


Test duration (secs)  Data length (bytes)  Total messages received  Total data bytes received  Messages per sec  Data bytes per sec  Rx thread free delay (us)  Tx thread max get send buffer (us)  
            1.000027                    0                   971294                          0            971268                   0                         10                                  33  
            1.005532                   16                    90033                    1440528             89538             1432604                      10000                               10002  
            1.000023                    0                  1022579                          0           1022555                   0  
            1.000023                    1                  1015330                    1015330           1015307             1015307  
            1.000033                    2                  1026882                    2053764           1026848             2053696  
            1.000012                    4                  1022535                    4090140           1022522             4090089  
            1.000015                    8                  1033409                    8267272           1033394             8267148  
            1.000032                   16                   982002                   15712032            981970            15711524  
            1.000026                   32                   934985                   29919520            934961            29918743  
            1.000028                   64                   863665                   55274560            863640            55272990  
            1.000027                  128                   950638                  121681664            950612           121678390  
            1.000027                  256                   901245                  230718720            901220           230712389  
            1.000041                  512                   823739                  421754368            823706           421737279  
            1.000029                 1024                   756591                  774749184            756569           774726673  
            1.000056                 2048                   574707                 1176999936            574675          1176933904  
            1.000072                 4096                   425142                 1741381632            425112          1741257083  
            1.000110                 8192                   279008                 2285633536            278977          2285382018  
            1.000209                16384                   144641                 2369798144            144611          2369302372  
            1.000419                32768                    75534                 2475098112             75502          2474060484  
            1.000838                65536                    39115                 2563440640             39082          2561293387  
            1.001624               131072                    20205                 2648309760             20172          2644016000  
            1.003153               262144                    10334                 2708996096             10302          2700481685  
            1.006301               524288                     5243                 2748841984              5210          2731628667  
            1.012301              1048576                     2652                 2780823552              2620          2747032036  
            1.024889              2097152                     1346                 2822766592              1313          2754215754  
            1.049561              4194304                      690                 2894069760               657          2757411022  
            1.098003              8388608                      361                 3028287488               329          2757996626  
            1.198181             16777216                      197                 3305111552               164          2758441723  

Testing using sender using send and the receiver using recv
sender_qp capabilities: max_send_wr=95 max_recv_wr=32 max_send_sge=2 max_recv_sge=1 max_inline_data=28
receiver_qp capabilities: max_send_wr=95 max_recv_wr=32 max_send_sge=2 max_recv_sge=1 max_inline_data=28
Current CPU frequencies (MHz) :  2901000  2901000  2901000  2901000
Changes to statistics for initialisation of Infiniband communications:
  Num voluntary context switches = 40 (316 -> 356)
  Num page reclaims = 1550 (3231 -> 4781)
  Num page faults = 0 (1 -> 1)
  Num mlx4 interrupts = 40 (4555 -> 4595)

Changes to statistics for Infiniband single thread message transfers:
  Num voluntary context switches = 0 (356 -> 356)
  Num page reclaims = 0 (4781 -> 4781)
  Num page faults = 0 (1 -> 1)
  Num mlx4 interrupts = 0 (4595 -> 4595)

Changes to statistics for Infiniband multi-threaded message transfers:
  Num voluntary context switches = 84 (356 -> 440)
  Num page reclaims = 0 (4781 -> 4781)
  Num page faults = 0 (1 -> 1)
  Num mlx4 interrupts = 0 (4595 -> 4595)


Test duration (secs)  Data length (bytes)  Total messages received  Total data bytes received  Messages per sec  Data bytes per sec  Rx thread free delay (us)  Tx thread max get send buffer (us)  
            1.000017                    0                   838923                          0            838908                   0                         10                                  33  
            1.008541                   16                    90033                    1440528             89271             1428328                      10000                               10003  
            1.000029                    0                   804066                          0            804043                   0  
            1.000025                    1                   864551                     864551            864529              864529  
            1.000011                    2                   857318                    1714636            857309             1714617  
            1.000029                    4                   875005                    3500020            874979             3499918  
            1.000024                    8                   861664                    6893312            861643             6893147  
            1.000023                   16                   961549                   15384784            961527            15384424  
            1.000021                   32                   974080                   31170560            974060            31169920  
            1.000019                   64                   956339                   61205696            956321            61204549  
            1.000035                  128                   934557                  119623296            934524           119619052  
            1.000033                  256                   923803                  236493568            923773           236485821  
            1.000035                  512                   870751                  445824512            870721           445808906  
            1.000031                 1024                   724067                  741444608            724044           741421448  
            1.000037                 2048                   634124                 1298685952            634101          1298638458  
            1.000065                 4096                   449154                 1839734784            449125          1839614718  
            1.000122                 8192                   278606                 2282340352            278572          2282062753  
            1.000215                16384                   145739                 2387787776            145708          2387273541  
            1.000420                32768                    75797                 2483716096             75765          2482673664  
            1.000811                65536                    39885                 2613903360             39853          2611785648  
            1.001583               131072                    20523                 2689990656             20491          2685738329  
            1.003136               262144                    10419                 2731278336             10386          2722740866  
            1.006278               524288                     5263                 2759327744              5230          2742113567  
            1.012264              1048576                     2656                 2785017856              2624          2751276740  
            1.024895              2097152                     1347                 2824863744              1314          2756247801  
            1.049069              4194304                      690                 2894069760               658          2758702988  
            1.097352              8388608                      361                 3028287488               329          2759630813  
            1.197068             16777216                      197                 3305111552               165          2761006433  


Results when CPU frequency set to 1.8 GHz
=========================================

To set the max fixed frequency added intel_pstate=disable to the boot line and ran:
$ sudo cpufreq-set -f 1800000 -c 0
$ sudo cpufreq-set -f 1800000 -c 1
$ sudo cpufreq-set -f 1800000 -c 2
$ sudo cpufreq-set -f 1800000 -c 3

$ ibv_functional_loopback_test/Release/ibv_functional_loopback_test 
Attributes of device mlx4_0:
 num_comp_vectors=8 fw_ver=2.9.1000
 node_guid=0x8c504b0003c90200 sys_image_guid=0x8f504b0003c90200
 max_mr_size=18446744073709551615 page_size_cap=4294966784 vendor_id=0x2c9 vendor_part_id=0x673c hw_ver=176
 max_qp=131000 max_qp_wr=16351 max_sge=32 max_sge_rd=30
device_cap_flags=IBV_DEVICE_BAD_PKEY_CNTR|IBV_DEVICE_BAD_QKEY_CNTR|IBV_DEVICE_AUTO_PATH_MIG|IBV_DEVICE_CHANGE_PHY_PORT|IBV_DEVICE_UD_AV_PORT_ENFORCE|IBV_DEVICE_PORT_ACTIVE_EVENT|IBV_DEVICE_SYS_IMAGE_GUID|IBV_DEVICE_RC_RNR_NAK_GEN|BIT15|IBV_DEVICE_IP_CSUM|BIT19|IBV_DEVICE_XRC|BIT21|BIT22|BIT26
 max_cq=65408 max_cqe=4194303 max_mr=524272 max_pd=32764
 max_qp_rd_atom=16 max_ee_rd_atom=0 max_res_rd_atom=2096000 max_qp_init_rd_atom=128
 max_ee_init_rd_atom=0 atomic_cap=IBV_ATOMIC_HCA
 max_ee=0 max_rdd=0 max_mw=0 max_raw_ipv6_qp=0 max_raw_ethy_qp=0
 max_mcast_grp=8192 max_mcast_qp_attach=248 max_total_mcast_qp_attach=2031616
 max_ah=0 max_fmr=0 max_map_per_fmr=8191 max_srq=65472 max_srq_wr=16383
 max_srq_sge=31 max_pkeys=128 local_ca_ack_delay=15 phys_port_cnt=2
Attributes of source port 1:
 state=IBV_PORT_ACTIVE max_mtu=IBV_MTU_4096 active_mtu=IBV_MTU_4096
 gid_tbl_len=128 port_cap_flags=0x251086a max_msg_sz=1073741824
 bad_pkey_cntr=0 qkey_viol_cntr=0 pkey_tbl_len=128 lid=1 sm_lid=1
 lmc=0 max_vl_num=3 sm_sl=0 subnet_timeout=18 init_type_reply=0
 active_width=2 active_speed=4 phys_state=5 link_layer=IBV_LINK_LAYER_INFINIBAND
Attributes of destination port 2:
 state=IBV_PORT_ACTIVE max_mtu=IBV_MTU_4096 active_mtu=IBV_MTU_4096
 gid_tbl_len=128 port_cap_flags=0x2510868 max_msg_sz=1073741824
 bad_pkey_cntr=0 qkey_viol_cntr=0 pkey_tbl_len=128 lid=2 sm_lid=1
 lmc=0 max_vl_num=3 sm_sl=0 subnet_timeout=18 init_type_reply=0
 active_width=2 active_speed=4 phys_state=5 link_layer=IBV_LINK_LAYER_INFINIBAND

Testing using sender using RDMA write and the receiver passive
message_send_qp capabilities: max_send_wr=223 max_recv_wr=1 max_send_sge=2 max_recv_sge=1 max_inline_data=28
freed_sequence_number_qp capabilities: max_send_wr=95 max_recv_wr=1 max_send_sge=2 max_recv_sge=1 max_inline_data=28
Current CPU frequencies (MHz) :  1800000  1800000  1800000  1800000
Changes to statistics for initialisation of Infiniband communications:
  Num voluntary context switches = 38 (10 -> 48)
  Num page reclaims = 1555 (125 -> 1680)
  Num page faults = 0 (0 -> 0)
  Num mlx4 interrupts = 38 (4625 -> 4663)

Changes to statistics for Infiniband single thread message transfers:
  Num voluntary context switches = 0 (48 -> 48)
  Num page reclaims = 0 (1681 -> 1681)
  Num page faults = 0 (0 -> 0)
  Num mlx4 interrupts = 0 (4663 -> 4663)

Changes to statistics for Infiniband multi-threaded message transfers:
  Num voluntary context switches = 84 (48 -> 132)
  Num page reclaims = 0 (1681 -> 1681)
  Num page faults = 0 (0 -> 0)
  Num mlx4 interrupts = 0 (4663 -> 4663)


Test duration (secs)  Data length (bytes)  Total messages received  Total data bytes received  Messages per sec  Data bytes per sec  Rx thread free delay (us)  Tx thread max get send buffer (us)  
            0.999999                    0                  2194390                          0           2194392                   0                         10                                  12  
            1.005261                   16                    95033                    1520528             94536             1512571                      10000                                9994  
            1.000005                    0                  2159841                          0           2159829                   0  
            1.000006                    1                  2044701                    2044701           2044689             2044689  
            1.000008                    2                  2044687                    4089374           2044670             4089340  
            1.000007                    4                  2044553                    8178212           2044538             8178153  
            1.000007                    8                  2044203                   16353624           2044189            16353514  
            1.000007                   16                  2043934                   32702944           2043919            32702708  
            1.000007                   32                  1823436                   58349952           1823423            58349545  
            1.000009                   64                  1807492                  115679488           1807476           115678471  
            1.000010                  128                  1737663                  222420864           1737646           222418705  
            1.000010                  256                  1617634                  414114304           1617618           414110238  
            1.000012                  512                  1450877                  742849024           1450859           742839951  
            1.000023                 1024                  1227378                 1256835072           1227350          1256806722  
            1.000034                 2048                   877043                 1796184064            877013          1796123113  
            1.000053                 4096                   550470                 2254725120            550441          2254605276  
            1.000100                 8192                   317357                 2599788544            317325          2599527962  
            1.000207                16384                   155402                 2546106368            155370          2545579173  
            1.000410                32768                    78464                 2571108352             78432          2570053458  
            1.000810                65536                    39971                 2619539456             39939          2617418185  
            1.001566               131072                    20663                 2708340736             20631          2704106038  
            1.003080               262144                    10554                 2766667776             10522          2758173163  
            1.006076               524288                     5348                 2803892224              5316          2786958569  
            1.012094              1048576                     2704                 2835349504              2672          2801467226  
            1.023982              2097152                     1371                 2875195392              1339          2807858141  
            1.049035              4194304                      703                 2948595712               670          2810768753  
            1.097647              8388608                      368                 3087007744               335          2812387124  
            1.194134             16777216                      200                 3355443200               167          2809939193  

Testing using sender using RDMA write with immediate and the receiver polling the CQ
sender_qp capabilities: max_send_wr=95 max_recv_wr=32 max_send_sge=2 max_recv_sge=1 max_inline_data=28
receiver_qp capabilities: max_send_wr=95 max_recv_wr=32 max_send_sge=2 max_recv_sge=1 max_inline_data=28
Current CPU frequencies (MHz) :  1800000  1800000  1800000  1800000
Changes to statistics for initialisation of Infiniband communications:
  Num voluntary context switches = 40 (159 -> 199)
  Num page reclaims = 1550 (1682 -> 3232)
  Num page faults = 0 (0 -> 0)
  Num mlx4 interrupts = 40 (4685 -> 4725)

Changes to statistics for Infiniband single thread message transfers:
  Num voluntary context switches = 0 (199 -> 199)
  Num page reclaims = 0 (3232 -> 3232)
  Num page faults = 0 (0 -> 0)
  Num mlx4 interrupts = 0 (4725 -> 4725)

Changes to statistics for Infiniband multi-threaded message transfers:
  Num voluntary context switches = 84 (199 -> 283)
  Num page reclaims = 0 (3232 -> 3232)
  Num page faults = 0 (0 -> 0)
  Num mlx4 interrupts = 0 (4725 -> 4725)


Test duration (secs)  Data length (bytes)  Total messages received  Total data bytes received  Messages per sec  Data bytes per sec  Rx thread free delay (us)  Tx thread max get send buffer (us)  
            1.000018                    0                   960194                          0            960177                   0                         10                                  34  
            1.002571                   16                    90033                    1440528             89802             1436833                      10000                                9999  
            1.000022                    0                  1034867                          0           1034844                   0  
            1.000011                    1                  1034939                    1034939           1034928             1034928  
            1.000012                    2                  1040621                    2081242           1040608             2081217  
            1.000015                    4                  1037886                    4151544           1037870             4151480  
            1.000009                    8                  1032578                    8260624           1032569             8260549  
            1.000020                   16                   987663                   15802608            987644            15802297  
            1.000016                   32                   991437                   31725984            991422            31725492  
            1.000021                   64                   987468                   63197952            987447            63196636  
            1.000031                  128                   958682                  122711296            958652           122707493  
            1.000030                  256                   931618                  238494208            931590           238486968  
            1.000016                  512                   897445                  459491840            897431           459484539  
            1.000030                 1024                   766881                  785286144            766858           785262799  
            1.000056                 2048                   570258                 1167888384            570226          1167822737  
            1.000073                 4096                   426992                 1748959232            426961          1748832094  
            1.000120                 8192                   278556                 2281930752            278523          2281657578  
            1.000235                16384                   144384                 2365587456            144350          2365032421  
            1.000415                32768                    75369                 2469691392             75338          2468667056  
            1.000813                65536                    39080                 2561146880             39048          2559067264  
            1.001610               131072                    20163                 2642804736             20131          2638555819  
            1.003165               262144                    10319                 2705063936             10286          2696528434  
            1.006286               524288                     5236                 2745171968              5203          2728022370  
            1.012547              1048576                     2650                 2778726400              2617          2744293169  
            1.025014              2097152                     1345                 2820669440              1312          2751836034  
            1.049070              4194304                      689                 2889875456               657          2754703444  
            1.098810              8388608                      361                 3028287488               329          2755970984  
            1.198794             16777216                      197                 3305111552               164          2757031038  

Testing using sender using send and the receiver using recv
sender_qp capabilities: max_send_wr=95 max_recv_wr=32 max_send_sge=2 max_recv_sge=1 max_inline_data=28
receiver_qp capabilities: max_send_wr=95 max_recv_wr=32 max_send_sge=2 max_recv_sge=1 max_inline_data=28
Current CPU frequencies (MHz) :  1800000  1800000  1800000  1800000
Changes to statistics for initialisation of Infiniband communications:
  Num voluntary context switches = 40 (313 -> 353)
  Num page reclaims = 1550 (3232 -> 4782)
  Num page faults = 0 (0 -> 0)
  Num mlx4 interrupts = 40 (4749 -> 4789)

Changes to statistics for Infiniband single thread message transfers:
  Num voluntary context switches = 0 (353 -> 353)
  Num page reclaims = 0 (4782 -> 4782)
  Num page faults = 0 (0 -> 0)
  Num mlx4 interrupts = 0 (4789 -> 4789)

Changes to statistics for Infiniband multi-threaded message transfers:
  Num voluntary context switches = 84 (353 -> 437)
  Num page reclaims = 0 (4782 -> 4782)
  Num page faults = 0 (0 -> 0)
  Num mlx4 interrupts = 0 (4789 -> 4789)


Test duration (secs)  Data length (bytes)  Total messages received  Total data bytes received  Messages per sec  Data bytes per sec  Rx thread free delay (us)  Tx thread max get send buffer (us)  
            1.000013                    0                   829340                          0            829329                   0                         10                                  34  
            1.005099                   16                    90033                    1440528             89576             1433220                      10000                               10000  
            1.000020                    0                   880918                          0            880900                   0  
            1.000009                    1                   864358                     864358            864350              864350  
            1.000015                    2                   830201                    1660402            830189             1660377  
            1.000002                    4                   875520                    3502080            875519             3502074  
            1.000031                    8                   903391                    7227128            903363             7226904  
            1.000017                   16                   984896                   15758336            984879            15758062  
            1.000036                   32                   987669                   31605408            987633            31604257  
            1.000030                   64                   998080                   63877120            998050            63875191  
            1.000018                  128                   969191                  124056448            969174           124054262  
            1.000022                  256                   923717                  236471552            923697           236466308  
            1.000029                  512                   878752                  449921024            878726           449907891  
            1.000045                 1024                   737245                  754938880            737212           754904830  
            1.000033                 2048                   628000                 1286144000            627979          1286101869  
            1.000069                 4096                   447485                 1832898560            447454          1832771901  
            1.000109                 8192                   278687                 2283003904            278657          2282755346  
            1.000221                16384                   146320                 2397306880            146288          2396777209  
            1.000422                32768                    75433                 2471788544             75401          2470745504  
            1.000802                65536                    39781                 2607087616             39749          2604998207  
            1.001590               131072                    20487                 2685272064             20454          2681010424  
            1.003094               262144                    10409                 2728656896             10377          2720241508  
            1.006135               524288                     5258                 2756706304              5226          2739897763  
            1.012349              1048576                     2655                 2783969280              2623          2750010547  
            1.024751              2097152                     1346                 2822766592              1313          2754587575  
            1.049877              4194304                      690                 2894069760               657          2756580915  
            1.098020              8388608                      361                 3028287488               329          2757953212  
            1.197847             16777216                      197                 3305111552               164          2759209538  


Results when CPU frequency set to 1.8 GHz
=========================================

The commited code uses a max data length of 16Mbyte and 32 buffers.
The code was temporarily changed to reduce the max data length to 1Mbyte and increase the number of buffers to 512 (for same overall memory usage).

With the increase of buffers there was less of reported short message rate between IBV_WR_RDMA_WRITE and IBV_WR_RDMA_WRITE_WITH_IMM/IBV_WR_SEND
but IBV_WR_RDMA_WRITE still gave the highest message rate.

$ ibv_functional_loopback_test/Release/ibv_functional_loopback_test 
Attributes of device mlx4_0:
 num_comp_vectors=8 fw_ver=2.9.1000
 node_guid=0x8c504b0003c90200 sys_image_guid=0x8f504b0003c90200
 max_mr_size=18446744073709551615 page_size_cap=4294966784 vendor_id=0x2c9 vendor_part_id=0x673c hw_ver=176
 max_qp=131000 max_qp_wr=16351 max_sge=32 max_sge_rd=30
device_cap_flags=IBV_DEVICE_BAD_PKEY_CNTR|IBV_DEVICE_BAD_QKEY_CNTR|IBV_DEVICE_AUTO_PATH_MIG|IBV_DEVICE_CHANGE_PHY_PORT|IBV_DEVICE_UD_AV_PORT_ENFORCE|IBV_DEVICE_PORT_ACTIVE_EVENT|IBV_DEVICE_SYS_IMAGE_GUID|IBV_DEVICE_RC_RNR_NAK_GEN|BIT15|IBV_DEVICE_IP_CSUM|BIT19|IBV_DEVICE_XRC|BIT21|BIT22|BIT26
 max_cq=65408 max_cqe=4194303 max_mr=524272 max_pd=32764
 max_qp_rd_atom=16 max_ee_rd_atom=0 max_res_rd_atom=2096000 max_qp_init_rd_atom=128
 max_ee_init_rd_atom=0 atomic_cap=IBV_ATOMIC_HCA
 max_ee=0 max_rdd=0 max_mw=0 max_raw_ipv6_qp=0 max_raw_ethy_qp=0
 max_mcast_grp=8192 max_mcast_qp_attach=248 max_total_mcast_qp_attach=2031616
 max_ah=0 max_fmr=0 max_map_per_fmr=8191 max_srq=65472 max_srq_wr=16383
 max_srq_sge=31 max_pkeys=128 local_ca_ack_delay=15 phys_port_cnt=2
Attributes of source port 1:
 state=IBV_PORT_ACTIVE max_mtu=IBV_MTU_4096 active_mtu=IBV_MTU_4096
 gid_tbl_len=128 port_cap_flags=0x251086a max_msg_sz=1073741824
 bad_pkey_cntr=0 qkey_viol_cntr=0 pkey_tbl_len=128 lid=1 sm_lid=1
 lmc=0 max_vl_num=3 sm_sl=0 subnet_timeout=18 init_type_reply=0
 active_width=2 active_speed=4 phys_state=5 link_layer=IBV_LINK_LAYER_INFINIBAND
Attributes of destination port 2:
 state=IBV_PORT_ACTIVE max_mtu=IBV_MTU_4096 active_mtu=IBV_MTU_4096
 gid_tbl_len=128 port_cap_flags=0x2510868 max_msg_sz=1073741824
 bad_pkey_cntr=0 qkey_viol_cntr=0 pkey_tbl_len=128 lid=2 sm_lid=1
 lmc=0 max_vl_num=3 sm_sl=0 subnet_timeout=18 init_type_reply=0
 active_width=2 active_speed=4 phys_state=5 link_layer=IBV_LINK_LAYER_INFINIBAND

Testing using sender using RDMA write and the receiver passive
message_send_qp capabilities: max_send_wr=4063 max_recv_wr=1 max_send_sge=2 max_recv_sge=1 max_inline_data=28
freed_sequence_number_qp capabilities: max_send_wr=2015 max_recv_wr=1 max_send_sge=2 max_recv_sge=1 max_inline_data=28
Current CPU frequencies (MHz) :  1800000  1800000  1800000  1800000
Changes to statistics for initialisation of Infiniband communications:
  Num voluntary context switches = 38 (10 -> 48)
  Num page reclaims = 1719 (124 -> 1843)
  Num page faults = 0 (0 -> 0)
  Num mlx4 interrupts = 38 (5401 -> 5439)

Changes to statistics for Infiniband single thread message transfers:
  Num voluntary context switches = 0 (48 -> 48)
  Num page reclaims = 3 (1843 -> 1846)
  Num page faults = 0 (0 -> 0)
  Num mlx4 interrupts = 0 (5439 -> 5439)

Changes to statistics for Infiniband multi-threaded message transfers:
  Num voluntary context switches = 72 (48 -> 120)
  Num page reclaims = 10 (1846 -> 1856)
  Num page faults = 0 (0 -> 0)
  Num mlx4 interrupts = 0 (5439 -> 5439)


Test duration (secs)  Data length (bytes)  Total messages received  Total data bytes received  Messages per sec  Data bytes per sec  Rx thread free delay (us)  Tx thread max get send buffer (us)  
            1.000110                    0                  2220939                          0           2220694                   0                         10                                  19  
            1.004420                   16                    97513                    1560208             97084             1553343                      10000                                9950  
            1.000102                    0                  2226667                          0           2226439                   0  
            1.000161                    1                  2086111                    2086111           2085776             2085776  
            1.000163                    2                  2085944                    4171888           2085604             4171207  
            1.000162                    4                  2085974                    8343896           2085636             8342543  
            1.000162                    8                  2084570                   16676560           2084233            16673865  
            1.000160                   16                  2087650                   33402400           2087316            33397059  
            1.000249                   32                  1861108                   59555456           1860645            59540649  
            1.000248                   64                  1847969                  118270016           1847510           118240636  
            1.000267                  128                  1753594                  224460032           1753126           224400186  
            1.000293                  256                  1631087                  417558272           1630610           417436080  
            1.000331                  512                  1456303                  745627136           1455821           745380163  
            1.000426                 1024                  1181707                 1210067968           1181203          1209552382  
            1.000601                 2048                   839344                 1718976512            838840          1717943640  
            1.000947                 4096                   536345                 2196869120            535838          2194791392  
            1.001617                 8192                   315164                 2581823488            314655          2577656634  
            1.003302                16384                   155399                 2546057216            154888          2537677510  
            1.006448                32768                    79963                 2620227584             79451          2603441745  
            1.012780                65536                    40628                 2662596608             40115          2628998639  
            1.024804               131072                    21162                 2773745664             20650          2706610254  
            1.048839               262144                    11007                 2885419008             10494          2751061117  
            1.096876               524288                     5803                 3042443264              5290          2773735514  
            1.194262              1048576                     3148                 3300917248              2636          2763981528  

Testing using sender using RDMA write with immediate and the receiver polling the CQ
sender_qp capabilities: max_send_wr=2015 max_recv_wr=512 max_send_sge=2 max_recv_sge=1 max_inline_data=28
receiver_qp capabilities: max_send_wr=2015 max_recv_wr=512 max_send_sge=2 max_recv_sge=1 max_inline_data=28
Current CPU frequencies (MHz) :  1800000  1800000  1800000  1800000
Changes to statistics for initialisation of Infiniband communications:
  Num voluntary context switches = 40 (147 -> 187)
  Num page reclaims = 1663 (1859 -> 3522)
  Num page faults = 0 (0 -> 0)
  Num mlx4 interrupts = 40 (5461 -> 5501)

Changes to statistics for Infiniband single thread message transfers:
  Num voluntary context switches = 0 (187 -> 187)
  Num page reclaims = 0 (3522 -> 3522)
  Num page faults = 0 (0 -> 0)
  Num mlx4 interrupts = 0 (5501 -> 5501)

Changes to statistics for Infiniband multi-threaded message transfers:
  Num voluntary context switches = 72 (187 -> 259)
  Num page reclaims = 6 (3522 -> 3528)
  Num page faults = 0 (0 -> 0)
  Num mlx4 interrupts = 0 (5501 -> 5501)


Test duration (secs)  Data length (bytes)  Total messages received  Total data bytes received  Messages per sec  Data bytes per sec  Rx thread free delay (us)  Tx thread max get send buffer (us)  
            1.000020                    0                  2032402                          0           2032361                   0                         10                                 135  
            1.002406                   16                    96513                    1544208             96281             1540502                      10000                                9917  
            1.000063                    0                  1916348                          0           1916227                   0  
            1.000218                    1                  1977657                    1977657           1977227             1977227  
            1.000186                    2                  1990389                    3980778           1990019             3980037  
            1.000204                    4                  1979364                    7917456           1978959             7915838  
            1.000203                    8                  1971733                   15773864           1971333            15770664  
            1.000134                   16                  1911739                   30587824           1911482            30583711  
            1.000021                   32                  1888156                   60420992           1888116            60419720  
            1.000190                   64                  1831203                  117196992           1830854           117174676  
            1.000064                  128                  1709293                  218789504           1709184           218775536  
            1.000191                  256                  1627377                  416608512           1627066           416528960  
            1.000359                  512                  1407978                  720884736           1407473           720626116  
            1.000439                 1024                  1182374                 1210750976           1181855          1210219797  
            1.000580                 2048                   841138                 1722650624            840651          1721652510  
            1.000954                 4096                   521658                 2136711168            521161          2134673833  
            1.001615                 8192                   311885                 2554961920            311382          2550842656  
            1.003243                16384                   156840                 2569666560            156333          2561360245  
            1.006507                32768                    78959                 2587328512             78449          2570601541  
            1.012443                65536                    41580                 2724986880             41069          2691496848  
            1.024703               131072                    21239                 2783838208             20727          2716725771  
            1.049199               262144                    10928                 2864709632             10416          2730377672  
            1.098043               524288                     5733                 3005743104              5221          2737362750  
            1.196290              1048576                     3120                 3271557120              2608          2734752514  

Testing using sender using send and the receiver using recv
sender_qp capabilities: max_send_wr=2015 max_recv_wr=512 max_send_sge=2 max_recv_sge=1 max_inline_data=28
receiver_qp capabilities: max_send_wr=2015 max_recv_wr=512 max_send_sge=2 max_recv_sge=1 max_inline_data=28
Current CPU frequencies (MHz) :  1800000  1800000  1800000  1800000
Changes to statistics for initialisation of Infiniband communications:
  Num voluntary context switches = 40 (288 -> 328)
  Num page reclaims = 1686 (3529 -> 5215)
  Num page faults = 0 (0 -> 0)
  Num mlx4 interrupts = 40 (5525 -> 5565)

Changes to statistics for Infiniband single thread message transfers:
  Num voluntary context switches = 0 (328 -> 328)
  Num page reclaims = 0 (5215 -> 5215)
  Num page faults = 0 (0 -> 0)
  Num mlx4 interrupts = 0 (5565 -> 5565)

Changes to statistics for Infiniband multi-threaded message transfers:
  Num voluntary context switches = 72 (328 -> 400)
  Num page reclaims = 6 (5215 -> 5221)
  Num page faults = 0 (0 -> 0)
  Num mlx4 interrupts = 0 (5565 -> 5565)


Test duration (secs)  Data length (bytes)  Total messages received  Total data bytes received  Messages per sec  Data bytes per sec  Rx thread free delay (us)  Tx thread max get send buffer (us)  
            1.000212                    0                  1831889                          0           1831502                   0                         10                                 131  
            1.003194                   16                    96513                    1544208             96206             1539291                      10000                                9929  
            1.000172                    0                  1776903                          0           1776597                   0  
            1.000153                    1                  1752400                    1752400           1752131             1752131  
            1.000132                    2                  1759544                    3519088           1759311             3518622  
            1.000184                    4                  1763256                    7053024           1762932             7051727  
            1.000180                    8                  1747712                   13981696           1747397            13979178  
            1.000076                   16                  1818333                   29093328           1818194            29091103  
            1.000051                   32                  1798826                   57562432           1798734            57559502  
            1.000021                   64                  1748269                  111889216           1748233           111886881  
            1.000025                  128                  1641641                  210130048           1641600           210124769  
            1.000299                  256                  1539451                  394099456           1538991           393981701  
            1.000325                  512                  1381760                  707461120           1381311           707231269  
            1.000425                 1024                  1127339                 1154395136           1126860          1153904770  
            1.000600                 2048                   831630                 1703178240            831132          1702157424  
            1.000968                 4096                   514700                 2108211200            514202          2106171891  
            1.001625                 8192                   308768                 2529427456            308267          2525323618  
            1.003247                16384                   156644                 2566455296            156137          2558147867  
            1.006588                32768                    77826                 2550202368             77317          2533510917  
            1.012968                65536                    39951                 2618228736             39440          2584711224  
            1.025234               131072                    20779                 2723545088             20268          2656510477  
            1.049788               262144                    10798                 2830630912             10286          2696382326  
            1.098860               524288                     5694                 2985295872              5182          2716721605  
            1.196431              1048576                     3120                 3271557120              2608          2734429134  


